'use strict';

require('source-map-support/register');

const join = require('path').join;

const pluginCompat = require('./util/plugin-compat');

let Append2Serializer;

const _blockSizeByName = {
  data: 4 * 1024,
  md5: 128,
  'missing-resolve': 256,
  module: 4 * 1024,
  'module-resolve': 1024,
  resolver: 256
};

class SerializerAppend2Plugin {
  apply(compiler) {
    pluginCompat.tap(compiler, 'hardSourceCacheFactory', 'Append2Serializer', factory => info => {
      if (info.type === 'data') {
        return SerializerAppend2Plugin.createSerializer(info);
      }
      return factory(info);
    });
  }
}

SerializerAppend2Plugin.createSerializer = ({
  cacheDirPath,
  name,
  autoParse
}) => {
  if (!Append2Serializer) {
    Append2Serializer = require('./SerializerAppend2');
  }

  return new Append2Serializer({
    cacheDirPath: join(cacheDirPath, name),
    blockSize: _blockSizeByName[name],
    autoParse: autoParse
  });
};

module.exports = SerializerAppend2Plugin;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi9TZXJpYWxpemVyQXBwZW5kMlBsdWdpbi5qcyJdLCJuYW1lcyI6WyJqb2luIiwicmVxdWlyZSIsInBsdWdpbkNvbXBhdCIsIkFwcGVuZDJTZXJpYWxpemVyIiwiX2Jsb2NrU2l6ZUJ5TmFtZSIsImRhdGEiLCJtZDUiLCJtb2R1bGUiLCJyZXNvbHZlciIsIlNlcmlhbGl6ZXJBcHBlbmQyUGx1Z2luIiwiYXBwbHkiLCJjb21waWxlciIsInRhcCIsImZhY3RvcnkiLCJpbmZvIiwidHlwZSIsImNyZWF0ZVNlcmlhbGl6ZXIiLCJjYWNoZURpclBhdGgiLCJuYW1lIiwiYXV0b1BhcnNlIiwiYmxvY2tTaXplIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU1BLE9BQU9DLFFBQVEsTUFBUixFQUFnQkQsSUFBN0I7O0FBRUEsTUFBTUUsZUFBZUQsUUFBUSxzQkFBUixDQUFyQjs7QUFFQSxJQUFJRSxpQkFBSjs7QUFFQSxNQUFNQyxtQkFBbUI7QUFDdkJDLFFBQU0sSUFBSSxJQURhO0FBRXZCQyxPQUFLLEdBRmtCO0FBR3ZCLHFCQUFtQixHQUhJO0FBSXZCQyxVQUFRLElBQUksSUFKVztBQUt2QixvQkFBa0IsSUFMSztBQU12QkMsWUFBVTtBQU5hLENBQXpCOztBQVNBLE1BQU1DLHVCQUFOLENBQThCO0FBQzVCQyxRQUFNQyxRQUFOLEVBQWdCO0FBQ2RULGlCQUFhVSxHQUFiLENBQ0VELFFBREYsRUFFRSx3QkFGRixFQUdFLG1CQUhGLEVBSUVFLFdBQVdDLFFBQVE7QUFDakIsVUFBSUEsS0FBS0MsSUFBTCxLQUFjLE1BQWxCLEVBQTBCO0FBQ3hCLGVBQU9OLHdCQUF3Qk8sZ0JBQXhCLENBQXlDRixJQUF6QyxDQUFQO0FBQ0Q7QUFDRCxhQUFPRCxRQUFRQyxJQUFSLENBQVA7QUFDRCxLQVRIO0FBV0Q7QUFiMkI7O0FBZ0I5Qkwsd0JBQXdCTyxnQkFBeEIsR0FBMkMsQ0FBQztBQUMxQ0MsY0FEMEM7QUFFMUNDLE1BRjBDO0FBRzFDQztBQUgwQyxDQUFELEtBSXJDO0FBQ0osTUFBSSxDQUFDaEIsaUJBQUwsRUFBd0I7QUFDdEJBLHdCQUFvQkYsUUFBUSxxQkFBUixDQUFwQjtBQUNEOztBQUVELFNBQU8sSUFBSUUsaUJBQUosQ0FBc0I7QUFDM0JjLGtCQUFjakIsS0FBS2lCLFlBQUwsRUFBbUJDLElBQW5CLENBRGE7QUFFM0JFLGVBQVdoQixpQkFBaUJjLElBQWpCLENBRmdCO0FBRzNCQyxlQUFXQTtBQUhnQixHQUF0QixDQUFQO0FBS0QsQ0FkRDs7QUFnQkFaLE9BQU9jLE9BQVAsR0FBaUJaLHVCQUFqQiIsImZpbGUiOiJoYXJkLXNvdXJjZS13ZWJwYWNrLXBsdWdpbi9saWIvU2VyaWFsaXplckFwcGVuZDJQbHVnaW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBqb2luID0gcmVxdWlyZSgncGF0aCcpLmpvaW47XG5cbmNvbnN0IHBsdWdpbkNvbXBhdCA9IHJlcXVpcmUoJy4vdXRpbC9wbHVnaW4tY29tcGF0Jyk7XG5cbmxldCBBcHBlbmQyU2VyaWFsaXplcjtcblxuY29uc3QgX2Jsb2NrU2l6ZUJ5TmFtZSA9IHtcbiAgZGF0YTogNCAqIDEwMjQsXG4gIG1kNTogMTI4LFxuICAnbWlzc2luZy1yZXNvbHZlJzogMjU2LFxuICBtb2R1bGU6IDQgKiAxMDI0LFxuICAnbW9kdWxlLXJlc29sdmUnOiAxMDI0LFxuICByZXNvbHZlcjogMjU2LFxufTtcblxuY2xhc3MgU2VyaWFsaXplckFwcGVuZDJQbHVnaW4ge1xuICBhcHBseShjb21waWxlcikge1xuICAgIHBsdWdpbkNvbXBhdC50YXAoXG4gICAgICBjb21waWxlcixcbiAgICAgICdoYXJkU291cmNlQ2FjaGVGYWN0b3J5JyxcbiAgICAgICdBcHBlbmQyU2VyaWFsaXplcicsXG4gICAgICBmYWN0b3J5ID0+IGluZm8gPT4ge1xuICAgICAgICBpZiAoaW5mby50eXBlID09PSAnZGF0YScpIHtcbiAgICAgICAgICByZXR1cm4gU2VyaWFsaXplckFwcGVuZDJQbHVnaW4uY3JlYXRlU2VyaWFsaXplcihpbmZvKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFjdG9yeShpbmZvKTtcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxufVxuXG5TZXJpYWxpemVyQXBwZW5kMlBsdWdpbi5jcmVhdGVTZXJpYWxpemVyID0gKHtcbiAgY2FjaGVEaXJQYXRoLFxuICBuYW1lLFxuICBhdXRvUGFyc2UsXG59KSA9PiB7XG4gIGlmICghQXBwZW5kMlNlcmlhbGl6ZXIpIHtcbiAgICBBcHBlbmQyU2VyaWFsaXplciA9IHJlcXVpcmUoJy4vU2VyaWFsaXplckFwcGVuZDInKTtcbiAgfVxuXG4gIHJldHVybiBuZXcgQXBwZW5kMlNlcmlhbGl6ZXIoe1xuICAgIGNhY2hlRGlyUGF0aDogam9pbihjYWNoZURpclBhdGgsIG5hbWUpLFxuICAgIGJsb2NrU2l6ZTogX2Jsb2NrU2l6ZUJ5TmFtZVtuYW1lXSxcbiAgICBhdXRvUGFyc2U6IGF1dG9QYXJzZSxcbiAgfSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNlcmlhbGl6ZXJBcHBlbmQyUGx1Z2luO1xuIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvdHlsZXJhcmJ1cy9kZXYvcHJvdmlkZXIvc3JjIn0=
