'use strict';

const join = require('path').join;

const pluginCompat = require('./util/plugin-compat');

let Append2Serializer;

const _blockSizeByName = {
  data: 4 * 1024,
  md5: 128,
  'missing-resolve': 256,
  module: 4 * 1024,
  'module-resolve': 1024,
  resolver: 256
};

class SerializerAppend2Plugin {
  apply(compiler) {
    pluginCompat.tap(compiler, 'hardSourceCacheFactory', 'Append2Serializer', factory => info => {
      if (info.type === 'data') {
        return SerializerAppend2Plugin.createSerializer(info);
      }
      return factory(info);
    });
  }
}

SerializerAppend2Plugin.createSerializer = ({
  cacheDirPath,
  name,
  autoParse
}) => {
  if (!Append2Serializer) {
    Append2Serializer = require('./SerializerAppend2');
  }

  return new Append2Serializer({
    cacheDirPath: join(cacheDirPath, name),
    blockSize: _blockSizeByName[name],
    autoParse: autoParse
  });
};

module.exports = SerializerAppend2Plugin;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi9TZXJpYWxpemVyQXBwZW5kMlBsdWdpbi5qcyJdLCJuYW1lcyI6WyJqb2luIiwicmVxdWlyZSIsInBsdWdpbkNvbXBhdCIsIkFwcGVuZDJTZXJpYWxpemVyIiwiX2Jsb2NrU2l6ZUJ5TmFtZSIsImRhdGEiLCJtZDUiLCJtb2R1bGUiLCJyZXNvbHZlciIsIlNlcmlhbGl6ZXJBcHBlbmQyUGx1Z2luIiwiYXBwbHkiLCJjb21waWxlciIsInRhcCIsImZhY3RvcnkiLCJpbmZvIiwidHlwZSIsImNyZWF0ZVNlcmlhbGl6ZXIiLCJjYWNoZURpclBhdGgiLCJuYW1lIiwiYXV0b1BhcnNlIiwiYmxvY2tTaXplIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxPQUFPQyxRQUFRLE1BQVIsRUFBZ0JELElBQTdCOztBQUVBLE1BQU1FLGVBQWVELCtCQUFyQjs7QUFFQSxJQUFJRSxpQkFBSjs7QUFFQSxNQUFNQyxtQkFBbUI7QUFDdkJDLFFBQU0sSUFBSSxJQURhO0FBRXZCQyxPQUFLLEdBRmtCO0FBR3ZCLHFCQUFtQixHQUhJO0FBSXZCQyxVQUFRLElBQUksSUFKVztBQUt2QixvQkFBa0IsSUFMSztBQU12QkMsWUFBVTtBQU5hLENBQXpCOztBQVNBLE1BQU1DLHVCQUFOLENBQThCO0FBQzVCQyxRQUFNQyxRQUFOLEVBQWdCO0FBQ2RULGlCQUFhVSxHQUFiLENBQ0VELFFBREYsRUFFRSx3QkFGRixFQUdFLG1CQUhGLEVBSUVFLFdBQVdDLFFBQVE7QUFDakIsVUFBSUEsS0FBS0MsSUFBTCxLQUFjLE1BQWxCLEVBQTBCO0FBQ3hCLGVBQU9OLHdCQUF3Qk8sZ0JBQXhCLENBQXlDRixJQUF6QyxDQUFQO0FBQ0Q7QUFDRCxhQUFPRCxRQUFRQyxJQUFSLENBQVA7QUFDRCxLQVRIO0FBV0Q7QUFiMkI7O0FBZ0I5Qkwsd0JBQXdCTyxnQkFBeEIsR0FBMkMsQ0FBQztBQUMxQ0MsY0FEMEM7QUFFMUNDLE1BRjBDO0FBRzFDQztBQUgwQyxDQUFELEtBSXJDO0FBQ0osTUFBSSxDQUFDaEIsaUJBQUwsRUFBd0I7QUFDdEJBLHdCQUFvQkYsOEJBQXBCO0FBQ0Q7O0FBRUQsU0FBTyxJQUFJRSxpQkFBSixDQUFzQjtBQUMzQmMsa0JBQWNqQixLQUFLaUIsWUFBTCxFQUFtQkMsSUFBbkIsQ0FEYTtBQUUzQkUsZUFBV2hCLGlCQUFpQmMsSUFBakIsQ0FGZ0I7QUFHM0JDLGVBQVdBO0FBSGdCLEdBQXRCLENBQVA7QUFLRCxDQWREOztBQWdCQVosT0FBT2MsT0FBUCxHQUFpQlosdUJBQWpCIiwiZmlsZSI6ImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi9TZXJpYWxpemVyQXBwZW5kMlBsdWdpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGpvaW4gPSByZXF1aXJlKCdwYXRoJykuam9pbjtcblxuY29uc3QgcGx1Z2luQ29tcGF0ID0gcmVxdWlyZSgnLi91dGlsL3BsdWdpbi1jb21wYXQnKTtcblxubGV0IEFwcGVuZDJTZXJpYWxpemVyO1xuXG5jb25zdCBfYmxvY2tTaXplQnlOYW1lID0ge1xuICBkYXRhOiA0ICogMTAyNCxcbiAgbWQ1OiAxMjgsXG4gICdtaXNzaW5nLXJlc29sdmUnOiAyNTYsXG4gIG1vZHVsZTogNCAqIDEwMjQsXG4gICdtb2R1bGUtcmVzb2x2ZSc6IDEwMjQsXG4gIHJlc29sdmVyOiAyNTYsXG59O1xuXG5jbGFzcyBTZXJpYWxpemVyQXBwZW5kMlBsdWdpbiB7XG4gIGFwcGx5KGNvbXBpbGVyKSB7XG4gICAgcGx1Z2luQ29tcGF0LnRhcChcbiAgICAgIGNvbXBpbGVyLFxuICAgICAgJ2hhcmRTb3VyY2VDYWNoZUZhY3RvcnknLFxuICAgICAgJ0FwcGVuZDJTZXJpYWxpemVyJyxcbiAgICAgIGZhY3RvcnkgPT4gaW5mbyA9PiB7XG4gICAgICAgIGlmIChpbmZvLnR5cGUgPT09ICdkYXRhJykge1xuICAgICAgICAgIHJldHVybiBTZXJpYWxpemVyQXBwZW5kMlBsdWdpbi5jcmVhdGVTZXJpYWxpemVyKGluZm8pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWN0b3J5KGluZm8pO1xuICAgICAgfSxcbiAgICApO1xuICB9XG59XG5cblNlcmlhbGl6ZXJBcHBlbmQyUGx1Z2luLmNyZWF0ZVNlcmlhbGl6ZXIgPSAoe1xuICBjYWNoZURpclBhdGgsXG4gIG5hbWUsXG4gIGF1dG9QYXJzZSxcbn0pID0+IHtcbiAgaWYgKCFBcHBlbmQyU2VyaWFsaXplcikge1xuICAgIEFwcGVuZDJTZXJpYWxpemVyID0gcmVxdWlyZSgnLi9TZXJpYWxpemVyQXBwZW5kMicpO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBBcHBlbmQyU2VyaWFsaXplcih7XG4gICAgY2FjaGVEaXJQYXRoOiBqb2luKGNhY2hlRGlyUGF0aCwgbmFtZSksXG4gICAgYmxvY2tTaXplOiBfYmxvY2tTaXplQnlOYW1lW25hbWVdLFxuICAgIGF1dG9QYXJzZTogYXV0b1BhcnNlLFxuICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2VyaWFsaXplckFwcGVuZDJQbHVnaW47XG4iXSwic291cmNlUm9vdCI6Ii9Vc2Vycy90eWxlcmFyYnVzL2Rldi9wcm92aWRlci9zcmMifQ==
