'use strict';

require('source-map-support/register');

const join = require('path').join;

const pluginCompat = require('./util/plugin-compat');

let AppendSerializer;

const _blockSizeByName = {
  data: 4 * 1024,
  md5: 128,
  'missing-resolve': 256,
  module: 4 * 1024,
  'module-resolve': 1024,
  resolver: 256
};

class SerializerAppendPlugin {
  apply(compiler) {
    pluginCompat.tap(compiler, 'hardSourceCacheFactory', 'AppendSerializer', factory => info => {
      if (info.type === 'data') {
        return SerializerAppendPlugin.createSerializer(info);
      }
      return factory(info);
    });
  }
}

SerializerAppendPlugin.createSerializer = ({
  cacheDirPath,
  name,
  autoParse
}) => {
  if (!AppendSerializer) {
    AppendSerializer = require('./SerializerAppend');
  }

  return new AppendSerializer({
    cacheDirPath: join(cacheDirPath, name),
    blockSize: _blockSizeByName[name],
    autoParse: autoParse
  });
};

module.exports = SerializerAppendPlugin;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi9TZXJpYWxpemVyQXBwZW5kUGx1Z2luLmpzIl0sIm5hbWVzIjpbImpvaW4iLCJyZXF1aXJlIiwicGx1Z2luQ29tcGF0IiwiQXBwZW5kU2VyaWFsaXplciIsIl9ibG9ja1NpemVCeU5hbWUiLCJkYXRhIiwibWQ1IiwibW9kdWxlIiwicmVzb2x2ZXIiLCJTZXJpYWxpemVyQXBwZW5kUGx1Z2luIiwiYXBwbHkiLCJjb21waWxlciIsInRhcCIsImZhY3RvcnkiLCJpbmZvIiwidHlwZSIsImNyZWF0ZVNlcmlhbGl6ZXIiLCJjYWNoZURpclBhdGgiLCJuYW1lIiwiYXV0b1BhcnNlIiwiYmxvY2tTaXplIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU1BLE9BQU9DLFFBQVEsTUFBUixFQUFnQkQsSUFBN0I7O0FBRUEsTUFBTUUsZUFBZUQsUUFBUSxzQkFBUixDQUFyQjs7QUFFQSxJQUFJRSxnQkFBSjs7QUFFQSxNQUFNQyxtQkFBbUI7QUFDdkJDLFFBQU0sSUFBSSxJQURhO0FBRXZCQyxPQUFLLEdBRmtCO0FBR3ZCLHFCQUFtQixHQUhJO0FBSXZCQyxVQUFRLElBQUksSUFKVztBQUt2QixvQkFBa0IsSUFMSztBQU12QkMsWUFBVTtBQU5hLENBQXpCOztBQVNBLE1BQU1DLHNCQUFOLENBQTZCO0FBQzNCQyxRQUFNQyxRQUFOLEVBQWdCO0FBQ2RULGlCQUFhVSxHQUFiLENBQ0VELFFBREYsRUFFRSx3QkFGRixFQUdFLGtCQUhGLEVBSUVFLFdBQVdDLFFBQVE7QUFDakIsVUFBSUEsS0FBS0MsSUFBTCxLQUFjLE1BQWxCLEVBQTBCO0FBQ3hCLGVBQU9OLHVCQUF1Qk8sZ0JBQXZCLENBQXdDRixJQUF4QyxDQUFQO0FBQ0Q7QUFDRCxhQUFPRCxRQUFRQyxJQUFSLENBQVA7QUFDRCxLQVRIO0FBV0Q7QUFiMEI7O0FBZ0I3QkwsdUJBQXVCTyxnQkFBdkIsR0FBMEMsQ0FBQztBQUN6Q0MsY0FEeUM7QUFFekNDLE1BRnlDO0FBR3pDQztBQUh5QyxDQUFELEtBSXBDO0FBQ0osTUFBSSxDQUFDaEIsZ0JBQUwsRUFBdUI7QUFDckJBLHVCQUFtQkYsUUFBUSxvQkFBUixDQUFuQjtBQUNEOztBQUVELFNBQU8sSUFBSUUsZ0JBQUosQ0FBcUI7QUFDMUJjLGtCQUFjakIsS0FBS2lCLFlBQUwsRUFBbUJDLElBQW5CLENBRFk7QUFFMUJFLGVBQVdoQixpQkFBaUJjLElBQWpCLENBRmU7QUFHMUJDLGVBQVdBO0FBSGUsR0FBckIsQ0FBUDtBQUtELENBZEQ7O0FBZ0JBWixPQUFPYyxPQUFQLEdBQWlCWixzQkFBakIiLCJmaWxlIjoiaGFyZC1zb3VyY2Utd2VicGFjay1wbHVnaW4vbGliL1NlcmlhbGl6ZXJBcHBlbmRQbHVnaW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBqb2luID0gcmVxdWlyZSgncGF0aCcpLmpvaW47XG5cbmNvbnN0IHBsdWdpbkNvbXBhdCA9IHJlcXVpcmUoJy4vdXRpbC9wbHVnaW4tY29tcGF0Jyk7XG5cbmxldCBBcHBlbmRTZXJpYWxpemVyO1xuXG5jb25zdCBfYmxvY2tTaXplQnlOYW1lID0ge1xuICBkYXRhOiA0ICogMTAyNCxcbiAgbWQ1OiAxMjgsXG4gICdtaXNzaW5nLXJlc29sdmUnOiAyNTYsXG4gIG1vZHVsZTogNCAqIDEwMjQsXG4gICdtb2R1bGUtcmVzb2x2ZSc6IDEwMjQsXG4gIHJlc29sdmVyOiAyNTYsXG59O1xuXG5jbGFzcyBTZXJpYWxpemVyQXBwZW5kUGx1Z2luIHtcbiAgYXBwbHkoY29tcGlsZXIpIHtcbiAgICBwbHVnaW5Db21wYXQudGFwKFxuICAgICAgY29tcGlsZXIsXG4gICAgICAnaGFyZFNvdXJjZUNhY2hlRmFjdG9yeScsXG4gICAgICAnQXBwZW5kU2VyaWFsaXplcicsXG4gICAgICBmYWN0b3J5ID0+IGluZm8gPT4ge1xuICAgICAgICBpZiAoaW5mby50eXBlID09PSAnZGF0YScpIHtcbiAgICAgICAgICByZXR1cm4gU2VyaWFsaXplckFwcGVuZFBsdWdpbi5jcmVhdGVTZXJpYWxpemVyKGluZm8pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWN0b3J5KGluZm8pO1xuICAgICAgfSxcbiAgICApO1xuICB9XG59XG5cblNlcmlhbGl6ZXJBcHBlbmRQbHVnaW4uY3JlYXRlU2VyaWFsaXplciA9ICh7XG4gIGNhY2hlRGlyUGF0aCxcbiAgbmFtZSxcbiAgYXV0b1BhcnNlLFxufSkgPT4ge1xuICBpZiAoIUFwcGVuZFNlcmlhbGl6ZXIpIHtcbiAgICBBcHBlbmRTZXJpYWxpemVyID0gcmVxdWlyZSgnLi9TZXJpYWxpemVyQXBwZW5kJyk7XG4gIH1cblxuICByZXR1cm4gbmV3IEFwcGVuZFNlcmlhbGl6ZXIoe1xuICAgIGNhY2hlRGlyUGF0aDogam9pbihjYWNoZURpclBhdGgsIG5hbWUpLFxuICAgIGJsb2NrU2l6ZTogX2Jsb2NrU2l6ZUJ5TmFtZVtuYW1lXSxcbiAgICBhdXRvUGFyc2U6IGF1dG9QYXJzZSxcbiAgfSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNlcmlhbGl6ZXJBcHBlbmRQbHVnaW47XG4iXSwic291cmNlUm9vdCI6Ii9Vc2Vycy90eWxlcmFyYnVzL2Rldi9wcm92aWRlci9zcmMifQ==
