'use strict';

const path = require('path');

let extractTextNS;
let extractTextNS2;
try {
  extractTextNS = path.dirname(require.resolve('extract-text-webpack-plugin'));
} catch (_) {}

const pluginCompat = require('./util/plugin-compat');

class SupportExtractTextPlugin {
  apply(compiler) {
    pluginCompat.tap(compiler, '_hardSourceAfterFreezeModule', 'SupportExtractTextPlugin', (frozen, module, extra) => {
      // Ignore the modules that kick off child compilers in extract text.
      // These modules must always be built so the child compilers run so
      // that assets get built.
      if (module[extractTextNS] || !module.factoryMeta && module.meta && module.meta[extractTextNS]) {
        return null;
      }

      return frozen;
    });
  }
}

module.exports = SupportExtractTextPlugin;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi9TdXBwb3J0RXh0cmFjdFRleHRQbHVnaW4uanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJleHRyYWN0VGV4dE5TIiwiZXh0cmFjdFRleHROUzIiLCJkaXJuYW1lIiwicmVzb2x2ZSIsIl8iLCJwbHVnaW5Db21wYXQiLCJTdXBwb3J0RXh0cmFjdFRleHRQbHVnaW4iLCJhcHBseSIsImNvbXBpbGVyIiwidGFwIiwiZnJvemVuIiwibW9kdWxlIiwiZXh0cmEiLCJmYWN0b3J5TWV0YSIsIm1ldGEiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLE9BQU9DLFFBQVEsTUFBUixDQUFiOztBQUVBLElBQUlDLGFBQUo7QUFDQSxJQUFJQyxjQUFKO0FBQ0EsSUFBSTtBQUNGRCxrQkFBZ0JGLEtBQUtJLE9BQUwsQ0FBYUgsUUFBUUksT0FBUixDQUFnQiw2QkFBaEIsQ0FBYixDQUFoQjtBQUNELENBRkQsQ0FFRSxPQUFPQyxDQUFQLEVBQVUsQ0FBRTs7QUFFZCxNQUFNQyxlQUFlTiwrQkFBckI7O0FBRUEsTUFBTU8sd0JBQU4sQ0FBK0I7QUFDN0JDLFFBQU1DLFFBQU4sRUFBZ0I7QUFDZEgsaUJBQWFJLEdBQWIsQ0FDRUQsUUFERixFQUVFLDhCQUZGLEVBR0UsMEJBSEYsRUFJRSxDQUFDRSxNQUFELEVBQVNDLE1BQVQsRUFBaUJDLEtBQWpCLEtBQTJCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLFVBQ0VELE9BQU9YLGFBQVAsS0FDQyxDQUFDVyxPQUFPRSxXQUFSLElBQXVCRixPQUFPRyxJQUE5QixJQUFzQ0gsT0FBT0csSUFBUCxDQUFZZCxhQUFaLENBRnpDLEVBR0U7QUFDQSxlQUFPLElBQVA7QUFDRDs7QUFFRCxhQUFPVSxNQUFQO0FBQ0QsS0FoQkg7QUFrQkQ7QUFwQjRCOztBQXVCL0JDLE9BQU9JLE9BQVAsR0FBaUJULHdCQUFqQiIsImZpbGUiOiJoYXJkLXNvdXJjZS13ZWJwYWNrLXBsdWdpbi9saWIvU3VwcG9ydEV4dHJhY3RUZXh0UGx1Z2luLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcblxubGV0IGV4dHJhY3RUZXh0TlM7XG5sZXQgZXh0cmFjdFRleHROUzI7XG50cnkge1xuICBleHRyYWN0VGV4dE5TID0gcGF0aC5kaXJuYW1lKHJlcXVpcmUucmVzb2x2ZSgnZXh0cmFjdC10ZXh0LXdlYnBhY2stcGx1Z2luJykpO1xufSBjYXRjaCAoXykge31cblxuY29uc3QgcGx1Z2luQ29tcGF0ID0gcmVxdWlyZSgnLi91dGlsL3BsdWdpbi1jb21wYXQnKTtcblxuY2xhc3MgU3VwcG9ydEV4dHJhY3RUZXh0UGx1Z2luIHtcbiAgYXBwbHkoY29tcGlsZXIpIHtcbiAgICBwbHVnaW5Db21wYXQudGFwKFxuICAgICAgY29tcGlsZXIsXG4gICAgICAnX2hhcmRTb3VyY2VBZnRlckZyZWV6ZU1vZHVsZScsXG4gICAgICAnU3VwcG9ydEV4dHJhY3RUZXh0UGx1Z2luJyxcbiAgICAgIChmcm96ZW4sIG1vZHVsZSwgZXh0cmEpID0+IHtcbiAgICAgICAgLy8gSWdub3JlIHRoZSBtb2R1bGVzIHRoYXQga2ljayBvZmYgY2hpbGQgY29tcGlsZXJzIGluIGV4dHJhY3QgdGV4dC5cbiAgICAgICAgLy8gVGhlc2UgbW9kdWxlcyBtdXN0IGFsd2F5cyBiZSBidWlsdCBzbyB0aGUgY2hpbGQgY29tcGlsZXJzIHJ1biBzb1xuICAgICAgICAvLyB0aGF0IGFzc2V0cyBnZXQgYnVpbHQuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBtb2R1bGVbZXh0cmFjdFRleHROU10gfHxcbiAgICAgICAgICAoIW1vZHVsZS5mYWN0b3J5TWV0YSAmJiBtb2R1bGUubWV0YSAmJiBtb2R1bGUubWV0YVtleHRyYWN0VGV4dE5TXSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZnJvemVuO1xuICAgICAgfSxcbiAgICApO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gU3VwcG9ydEV4dHJhY3RUZXh0UGx1Z2luO1xuIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvdHlsZXJhcmJ1cy9kZXYvcHJvdmlkZXIvc3JjIn0=
