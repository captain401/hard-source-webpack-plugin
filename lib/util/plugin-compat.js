'use strict';

require('source-map-support/register');

let hookTypes;

const callStyles = {
  sync: 'applyPlugins',
  syncWaterfall: 'applyPluginsWaterfall',
  syncBail: 'applyPluginsBailResult',
  sync_map: 'applyPlugins',
  asyncWaterfall: 'applyPluginsAsyncWaterfall',
  asyncParallel: 'applyPluginsParallel',
  asyncSerial: 'applyPluginsAsync'
};

const camelToDash = camel => camel.replace(/_/g, '--').replace(/[A-Z]/g, c => `-${c.toLowerCase()}`);

const knownPluginRegistrations = {
  Compilation: {
    needAdditionalPass: ['sync', []],
    succeedModule: ['sync', ['module']]
  },
  Compiler: {
    afterCompile: ['asyncSerial', ['compilation']],
    afterEnvironment: ['sync', []],
    afterPlugins: ['sync', []],
    afterResolvers: ['sync', []],
    compilation: ['sync', ['compilation', 'params']],
    emit: ['asyncSerial', ['compilation']],
    make: ['asyncParallel', ['compilation']],
    watchRun: ['asyncSerial', ['watcher']],
    run: ['asyncSerial', ['compiler']]
  },
  NormalModuleFactory: {
    createModule: ['syncBail', ['data']],
    parser: ['sync_map', ['parser', 'parserOptions']],
    resolver: ['syncWaterfall', ['nextResolver']]
  },
  ContextModuleFactory: {
    afterResolve: ['asyncWaterfall', ['data']]
  }
};

exports.register = (tapable, name, style, args) => {
  if (tapable.hooks) {
    if (!hookTypes) {
      const Tapable = require('tapable');
      hookTypes = {
        sync: Tapable.SyncHook,
        syncWaterfall: Tapable.SyncWaterfallHook,
        syncBail: Tapable.SyncBailHook,
        asyncWaterfall: Tapable.AsyncWaterfallHook,
        asyncParallel: Tapable.AsyncParallelHook,
        asyncSerial: Tapable.AsyncSeriesHook,
        asyncSeries: Tapable.AsyncSeriesHook
      };
    }
    if (!tapable.hooks[name]) {
      tapable.hooks[name] = new hookTypes[style](args);
    }
  } else {
    if (!tapable.__hardSource_hooks) {
      tapable.__hardSource_hooks = {};
    }
    if (!tapable.__hardSource_hooks[name]) {
      tapable.__hardSource_hooks[name] = {
        name,
        dashName: camelToDash(name),
        style,
        args,
        async: style.startsWith('async'),
        map: style.endsWith('_map')
      };
    }
    if (!tapable.__hardSource_proxy) {
      tapable.__hardSource_proxy = {};
    }
    if (!tapable.__hardSource_proxy[name]) {
      if (tapable.__hardSource_hooks[name].map) {
        const _forCache = {};
        tapable.__hardSource_proxy[name] = {
          _forCache,
          for: key => {
            let hook = _forCache[key];
            if (hook) {
              return hook;
            }
            _forCache[key] = {
              tap: (...args) => exports.tapFor(tapable, name, key, ...args),
              tapPromise: (...args) => exports.tapPromiseFor(tapable, name, key, ...args),
              call: (...args) => exports.callFor(tapable, name, key, ...args),
              promise: (...args) => exports.promiseFor(tapable, name, key, ...args)
            };
            return _forCache[key];
          },
          tap: (...args) => exports.tapFor(tapable, name, ...args),
          tapPromise: (...args) => exports.tapPromiseFor(tapable, name, ...args),
          call: (...args) => exports.callFor(tapable, name, ...args),
          promise: (...args) => exports.promiseFor(tapable, name, ...args)
        };
      } else {
        tapable.__hardSource_proxy[name] = {
          tap: (...args) => exports.tap(tapable, name, ...args),
          tapPromise: (...args) => exports.tapPromise(tapable, name, ...args),
          call: (...args) => exports.call(tapable, name, args),
          promise: (...args) => exports.promise(tapable, name, args)
        };
      }
    }
  }
};

exports.tap = (tapable, name, reason, callback) => {
  if (tapable.hooks) {
    tapable.hooks[name].tap(reason, callback);
  } else {
    if (!tapable.__hardSource_hooks || !tapable.__hardSource_hooks[name]) {
      const registration = knownPluginRegistrations[tapable.constructor.name][name];
      exports.register(tapable, name, registration[0], registration[1]);
    }
    const dashName = tapable.__hardSource_hooks[name].dashName;
    if (tapable.__hardSource_hooks[name].async) {
      tapable.plugin(dashName, (...args) => {
        const cb = args.pop();
        cb(null, callback(...args));
      });
    } else {
      tapable.plugin(dashName, callback);
    }
  }
};

exports.tapPromise = (tapable, name, reason, callback) => {
  if (tapable.hooks) {
    tapable.hooks[name].tapPromise(reason, callback);
  } else {
    if (!tapable.__hardSource_hooks || !tapable.__hardSource_hooks[name]) {
      const registration = knownPluginRegistrations[tapable.constructor.name][name];
      exports.register(tapable, name, registration[0], registration[1]);
    }
    const dashName = tapable.__hardSource_hooks[name].dashName;
    tapable.plugin(dashName, (...args) => {
      const cb = args.pop();
      return callback(...args).then(value => cb(null, value), cb);
    });
  }
};

exports.tapAsync = (tapable, name, reason, callback) => {
  if (tapable.hooks) {
    tapable.hooks[name].tapAsync(reason, callback);
  } else {
    if (!tapable.__hardSource_hooks || !tapable.__hardSource_hooks[name]) {
      const registration = knownPluginRegistrations[tapable.constructor.name][name];
      exports.register(tapable, name, registration[0], registration[1]);
    }
    const dashName = tapable.__hardSource_hooks[name].dashName;
    tapable.plugin(dashName, callback);
  }
};

exports.call = (tapable, name, args) => {
  if (tapable.hooks) {
    const hook = tapable.hooks[name];
    return hook.call(...args);
  } else {
    const dashName = tapable.__hardSource_hooks[name].dashName;
    const style = tapable.__hardSource_hooks[name].style;
    return tapable[callStyles[style]](...[dashName].concat(args));
  }
};

exports.promise = (tapable, name, args) => {
  if (tapable.hooks) {
    const hook = tapable.hooks[name];
    return hook.promise(...args);
  } else {
    const dashName = tapable.__hardSource_hooks[name].dashName;
    const style = tapable.__hardSource_hooks[name].style;
    return new Promise((resolve, reject) => {
      tapable[callStyles[style]](...[dashName].concat(args, (err, value) => {
        if (err) {
          reject(err);
        } else {
          resolve(value);
        }
      }));
    });
  }
};

exports.tapFor = (tapable, name, key, reason, callback) => {
  if (tapable.hooks) {
    tapable.hooks[name].for(key).tap(reason, callback);
  } else {
    exports.tap(tapable, name, reason, callback);
  }
};

exports.tapPromiseFor = (tapable, name, key, reason, callback) => {
  if (tapable.hooks) {
    tapable.hooks[name].for(key).tapPromise(reason, callback);
  } else {
    exports.tapPromise(tapable, name, reason, callback);
  }
};

exports.callFor = (tapable, name, key, args) => {
  if (tapable.hooks) {
    tapable.hooks[name].for(key).call(...args);
  } else {
    exports.call(tapable, name, args);
  }
};

exports.promiseFor = (tapable, name, key, args) => {
  if (tapable.hooks) {
    tapable.hooks[name].for(key).promise(...args);
  } else {
    exports.promise(tapable, name, args);
  }
};

exports.hooks = tapable => {
  if (tapable.hooks) {
    return tapable.hooks;
  }
  if (!tapable.__hardSource_proxy) {
    tapable.__hardSource_proxy = {};
  }
  const registrations = knownPluginRegistrations[tapable.constructor.name];
  if (registrations) {
    for (const name in registrations) {
      const registration = registrations[name];
      exports.register(tapable, name, registration[0], registration[1]);
    }
  }
  return tapable.__hardSource_proxy;
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi91dGlsL3BsdWdpbi1jb21wYXQuanMiXSwibmFtZXMiOlsiaG9va1R5cGVzIiwiY2FsbFN0eWxlcyIsInN5bmMiLCJzeW5jV2F0ZXJmYWxsIiwic3luY0JhaWwiLCJzeW5jX21hcCIsImFzeW5jV2F0ZXJmYWxsIiwiYXN5bmNQYXJhbGxlbCIsImFzeW5jU2VyaWFsIiwiY2FtZWxUb0Rhc2giLCJjYW1lbCIsInJlcGxhY2UiLCJjIiwidG9Mb3dlckNhc2UiLCJrbm93blBsdWdpblJlZ2lzdHJhdGlvbnMiLCJDb21waWxhdGlvbiIsIm5lZWRBZGRpdGlvbmFsUGFzcyIsInN1Y2NlZWRNb2R1bGUiLCJDb21waWxlciIsImFmdGVyQ29tcGlsZSIsImFmdGVyRW52aXJvbm1lbnQiLCJhZnRlclBsdWdpbnMiLCJhZnRlclJlc29sdmVycyIsImNvbXBpbGF0aW9uIiwiZW1pdCIsIm1ha2UiLCJ3YXRjaFJ1biIsInJ1biIsIk5vcm1hbE1vZHVsZUZhY3RvcnkiLCJjcmVhdGVNb2R1bGUiLCJwYXJzZXIiLCJyZXNvbHZlciIsIkNvbnRleHRNb2R1bGVGYWN0b3J5IiwiYWZ0ZXJSZXNvbHZlIiwiZXhwb3J0cyIsInJlZ2lzdGVyIiwidGFwYWJsZSIsIm5hbWUiLCJzdHlsZSIsImFyZ3MiLCJob29rcyIsIlRhcGFibGUiLCJyZXF1aXJlIiwiU3luY0hvb2siLCJTeW5jV2F0ZXJmYWxsSG9vayIsIlN5bmNCYWlsSG9vayIsIkFzeW5jV2F0ZXJmYWxsSG9vayIsIkFzeW5jUGFyYWxsZWxIb29rIiwiQXN5bmNTZXJpZXNIb29rIiwiYXN5bmNTZXJpZXMiLCJfX2hhcmRTb3VyY2VfaG9va3MiLCJkYXNoTmFtZSIsImFzeW5jIiwic3RhcnRzV2l0aCIsIm1hcCIsImVuZHNXaXRoIiwiX19oYXJkU291cmNlX3Byb3h5IiwiX2ZvckNhY2hlIiwiZm9yIiwia2V5IiwiaG9vayIsInRhcCIsInRhcEZvciIsInRhcFByb21pc2UiLCJ0YXBQcm9taXNlRm9yIiwiY2FsbCIsImNhbGxGb3IiLCJwcm9taXNlIiwicHJvbWlzZUZvciIsInJlYXNvbiIsImNhbGxiYWNrIiwicmVnaXN0cmF0aW9uIiwiY29uc3RydWN0b3IiLCJwbHVnaW4iLCJjYiIsInBvcCIsInRoZW4iLCJ2YWx1ZSIsInRhcEFzeW5jIiwiY29uY2F0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJlcnIiLCJyZWdpc3RyYXRpb25zIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUEsSUFBSUEsU0FBSjs7QUFFQSxNQUFNQyxhQUFhO0FBQ2pCQyxRQUFNLGNBRFc7QUFFakJDLGlCQUFlLHVCQUZFO0FBR2pCQyxZQUFVLHdCQUhPO0FBSWpCQyxZQUFVLGNBSk87QUFLakJDLGtCQUFnQiw0QkFMQztBQU1qQkMsaUJBQWUsc0JBTkU7QUFPakJDLGVBQWE7QUFQSSxDQUFuQjs7QUFVQSxNQUFNQyxjQUFjQyxTQUNsQkEsTUFBTUMsT0FBTixDQUFjLElBQWQsRUFBb0IsSUFBcEIsRUFBMEJBLE9BQTFCLENBQWtDLFFBQWxDLEVBQTRDQyxLQUFNLElBQUdBLEVBQUVDLFdBQUYsRUFBZ0IsRUFBckUsQ0FERjs7QUFHQSxNQUFNQywyQkFBMkI7QUFDL0JDLGVBQWE7QUFDWEMsd0JBQW9CLENBQUMsTUFBRCxFQUFTLEVBQVQsQ0FEVDtBQUVYQyxtQkFBZSxDQUFDLE1BQUQsRUFBUyxDQUFDLFFBQUQsQ0FBVDtBQUZKLEdBRGtCO0FBSy9CQyxZQUFVO0FBQ1JDLGtCQUFjLENBQUMsYUFBRCxFQUFnQixDQUFDLGFBQUQsQ0FBaEIsQ0FETjtBQUVSQyxzQkFBa0IsQ0FBQyxNQUFELEVBQVMsRUFBVCxDQUZWO0FBR1JDLGtCQUFjLENBQUMsTUFBRCxFQUFTLEVBQVQsQ0FITjtBQUlSQyxvQkFBZ0IsQ0FBQyxNQUFELEVBQVMsRUFBVCxDQUpSO0FBS1JDLGlCQUFhLENBQUMsTUFBRCxFQUFTLENBQUMsYUFBRCxFQUFnQixRQUFoQixDQUFULENBTEw7QUFNUkMsVUFBTSxDQUFDLGFBQUQs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QUFvQnFCLEdBQXBCLENBQXdCQyxHQUF4QixFQUE2QlEsT0FBN0IsQ0FBcUMsR0FBRzVCLElBQXhDO0FBQ0QsR0FGRCxNQUVPO0FBQ0xMLFlBQVFpQyxPQUFSLENBQWdCL0IsT0FBaEIsRUFBeUJDLElBQXpCLEVBQStCRSxJQUEvQjtBQUNEO0FBQ0YsQ0FORDs7QUFRQUwsUUFBUU0sS0FBUixHQUFnQkosV0FBVztBQUN6QixNQUFJQSxRQUFRSSxLQUFaLEVBQW1CO0FBQ2pCLFdBQU9KLFFBQVFJLEtBQWY7QUFDRDtBQUNELE1BQUksQ0FBQ0osUUFBUW9CLGtCQUFiLEVBQWlDO0FBQy9CcEIsWUFBUW9CLGtCQUFSLEdBQTZCLEVBQTdCO0FBQ0Q7QUFDRCxRQUFNNEIsZ0JBQWdCdEUseUJBQXlCc0IsUUFBUW9DLFdBQVIsQ0FBb0JuQyxJQUE3QyxDQUF0QjtBQUNBLE1BQUkrQyxhQUFKLEVBQW1CO0FBQ2pCLFNBQUssTUFBTS9DLElBQVgsSUFBbUIrQyxhQUFuQixFQUFrQztBQUNoQyxZQUFNYixlQUFlYSxjQUFjL0MsSUFBZCxDQUFyQjtBQUNBSCxjQUFRQyxRQUFSLENBQWlCQyxPQUFqQixFQUEwQkMsSUFBMUIsRUFBZ0NrQyxhQUFhLENBQWIsQ0FBaEMsRUFBaURBLGFBQWEsQ0FBYixDQUFqRDtBQUNEO0FBQ0Y7QUFDRCxTQUFPbkMsUUFBUW9CLGtCQUFmO0FBQ0QsQ0FmRCIsImZpbGUiOiJoYXJkLXNvdXJjZS13ZWJwYWNrLXBsdWdpbi9saWIvdXRpbC9wbHVnaW4tY29tcGF0LmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IGhvb2tUeXBlcztcblxuY29uc3QgY2FsbFN0eWxlcyA9IHtcbiAgc3luYzogJ2FwcGx5UGx1Z2lucycsXG4gIHN5bmNXYXRlcmZhbGw6ICdhcHBseVBsdWdpbnNXYXRlcmZhbGwnLFxuICBzeW5jQmFpbDogJ2FwcGx5UGx1Z2luc0JhaWxSZXN1bHQnLFxuICBzeW5jX21hcDogJ2FwcGx5UGx1Z2lucycsXG4gIGFzeW5jV2F0ZXJmYWxsOiAnYXBwbHlQbHVnaW5zQXN5bmNXYXRlcmZhbGwnLFxuICBhc3luY1BhcmFsbGVsOiAnYXBwbHlQbHVnaW5zUGFyYWxsZWwnLFxuICBhc3luY1NlcmlhbDogJ2FwcGx5UGx1Z2luc0FzeW5jJyxcbn07XG5cbmNvbnN0IGNhbWVsVG9EYXNoID0gY2FtZWwgPT5cbiAgY2FtZWwucmVwbGFjZSgvXy9nLCAnLS0nKS5yZXBsYWNlKC9bQS1aXS9nLCBjID0+IGAtJHtjLnRvTG93ZXJDYXNlKCl9YCk7XG5cbmNvbnN0IGtub3duUGx1Z2luUmVnaXN0cmF0aW9ucyA9IHtcbiAgQ29tcGlsYXRpb246IHtcbiAgICBuZWVkQWRkaXRpb25hbFBhc3M6IFsnc3luYycsIFtdXSxcbiAgICBzdWNjZWVkTW9kdWxlOiBbJ3N5bmMnLCBbJ21vZHVsZSddXSxcbiAgfSxcbiAgQ29tcGlsZXI6IHtcbiAgICBhZnRlckNvbXBpbGU6IFsnYXN5bmNTZXJpYWwnLCBbJ2NvbXBpbGF0aW9uJ11dLFxuICAgIGFmdGVyRW52aXJvbm1lbnQ6IFsnc3luYycsIFtdXSxcbiAgICBhZnRlclBsdWdpbnM6IFsnc3luYycsIFtdXSxcbiAgICBhZnRlclJlc29sdmVyczogWydzeW5jJywgW11dLFxuICAgIGNvbXBpbGF0aW9uOiBbJ3N5bmMnLCBbJ2NvbXBpbGF0aW9uJywgJ3BhcmFtcyddXSxcbiAgICBlbWl0OiBbJ2FzeW5jU2VyaWFsJywgWydjb21waWxhdGlvbiddXSxcbiAgICBtYWtlOiBbJ2FzeW5jUGFyYWxsZWwnLCBbJ2NvbXBpbGF0aW9uJ11dLFxuICAgIHdhdGNoUnVuOiBbJ2FzeW5jU2VyaWFsJywgWyd3YXRjaGVyJ11dLFxuICAgIHJ1bjogWydhc3luY1NlcmlhbCcsIFsnY29tcGlsZXInXV0sXG4gIH0sXG4gIE5vcm1hbE1vZHVsZUZhY3Rvcnk6IHtcbiAgICBjcmVhdGVNb2R1bGU6IFsnc3luY0JhaWwnLCBbJ2RhdGEnXV0sXG4gICAgcGFyc2VyOiBbJ3N5bmNfbWFwJywgWydwYXJzZXInLCAncGFyc2VyT3B0aW9ucyddXSxcbiAgICByZXNvbHZlcjogWydzeW5jV2F0ZXJmYWxsJywgWyduZXh0UmVzb2x2ZXInXV0sXG4gIH0sXG4gIENvbnRleHRNb2R1bGVGYWN0b3J5OiB7XG4gICAgYWZ0ZXJSZXNvbHZlOiBbJ2FzeW5jV2F0ZXJmYWxsJywgWydkYXRhJ11dLFxuICB9LFxufTtcblxuZXhwb3J0cy5yZWdpc3RlciA9ICh0YXBhYmxlLCBuYW1lLCBzdHlsZSwgYXJncykgPT4ge1xuICBpZiAodGFwYWJsZS5ob29rcykge1xuICAgIGlmICghaG9va1R5cGVzKSB7XG4gICAgICBjb25zdCBUYXBhYmxlID0gcmVxdWlyZSgndGFwYWJsZScpO1xuICAgICAgaG9va1R5cGVzID0ge1xuICAgICAgICBzeW5jOiBUYXBhYmxlLlN5bmNIb29rLFxuICAgICAgICBzeW5jV2F0ZXJmYWxsOiBUYXBhYmxlLlN5bmNXYXRlcmZhbGxIb29rLFxuICAgICAgICBzeW5jQmFpbDogVGFwYWJsZS5TeW5jQmFpbEhvb2ssXG4gICAgICAgIGFzeW5jV2F0ZXJmYWxsOiBUYXBhYmxlLkFzeW5jV2F0ZXJmYWxsSG9vayxcbiAgICAgICAgYXN5bmNQYXJhbGxlbDogVGFwYWJsZS5Bc3luY1BhcmFsbGVsSG9vayxcbiAgICAgICAgYXN5bmNTZXJpYWw6IFRhcGFibGUuQXN5bmNTZXJpZXNIb29rLFxuICAgICAgICBhc3luY1NlcmllczogVGFwYWJsZS5Bc3luY1Nlcmllc0hvb2ssXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoIXRhcGFibGUuaG9va3NbbmFtZV0pIHtcbiAgICAgIHRhcGFibGUuaG9va3NbbmFtZV0gPSBuZXcgaG9va1R5cGVzW3N0eWxlXShhcmdzKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKCF0YXBhYmxlLl9faGFyZFNvdXJjZV9ob29rcykge1xuICAgICAgdGFwYWJsZS5fX2hhcmRTb3VyY2VfaG9va3MgPSB7fTtcbiAgICB9XG4gICAgaWYgKCF0YXBhYmxlLl9faGFyZFNvdXJjZV9ob29rc1tuYW1lXSkge1xuICAgICAgdGFwYWJsZS5fX2hhcmRTb3VyY2VfaG9va3NbbmFtZV0gPSB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGRhc2hOYW1lOiBjYW1lbFRvRGFzaChuYW1lKSxcbiAgICAgICAgc3R5bGUsXG4gICAgICAgIGFyZ3MsXG4gICAgICAgIGFzeW5jOiBzdHlsZS5zdGFydHNXaXRoKCdhc3luYycpLFxuICAgICAgICBtYXA6IHN0eWxlLmVuZHNXaXRoKCdfbWFwJyksXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoIXRhcGFibGUuX19oYXJkU291cmNlX3Byb3h5KSB7XG4gICAgICB0YXBhYmxlLl9faGFyZFNvdXJjZV9wcm94eSA9IHt9O1xuICAgIH1cbiAgICBpZiAoIXRhcGFibGUuX19oYXJkU291cmNlX3Byb3h5W25hbWVdKSB7XG4gICAgICBpZiAodGFwYWJsZS5fX2hhcmRTb3VyY2VfaG9va3NbbmFtZV0ubWFwKSB7XG4gICAgICAgIGNvbnN0IF9mb3JDYWNoZSA9IHt9O1xuICAgICAgICB0YXBhYmxlLl9faGFyZFNvdXJjZV9wcm94eVtuYW1lXSA9IHtcbiAgICAgICAgICBfZm9yQ2FjaGUsXG4gICAgICAgICAgZm9yOiBrZXkgPT4ge1xuICAgICAgICAgICAgbGV0IGhvb2sgPSBfZm9yQ2FjaGVba2V5XTtcbiAgICAgICAgICAgIGlmIChob29rKSB7XG4gICAgICAgICAgICAgIHJldHVybiBob29rO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX2ZvckNhY2hlW2tleV0gPSB7XG4gICAgICAgICAgICAgIHRhcDogKC4uLmFyZ3MpID0+IGV4cG9ydHMudGFwRm9yKHRhcGFibGUsIG5hbWUsIGtleSwgLi4uYXJncyksXG4gICAgICAgICAgICAgIHRhcFByb21pc2U6ICguLi5hcmdzKSA9PlxuICAgICAgICAgICAgICAgIGV4cG9ydHMudGFwUHJvbWlzZUZvcih0YXBhYmxlLCBuYW1lLCBrZXksIC4uLmFyZ3MpLFxuICAgICAgICAgICAgICBjYWxsOiAoLi4uYXJncykgPT4gZXhwb3J0cy5jYWxsRm9yKHRhcGFibGUsIG5hbWUsIGtleSwgLi4uYXJncyksXG4gICAgICAgICAgICAgIHByb21pc2U6ICguLi5hcmdzKSA9PlxuICAgICAgICAgICAgICAgIGV4cG9ydHMucHJvbWlzZUZvcih0YXBhYmxlLCBuYW1lLCBrZXksIC4uLmFyZ3MpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiBfZm9yQ2FjaGVba2V5XTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRhcDogKC4uLmFyZ3MpID0+IGV4cG9ydHMudGFwRm9yKHRhcGFibGUsIG5hbWUsIC4uLmFyZ3MpLFxuICAgICAgICAgIHRhcFByb21pc2U6ICguLi5hcmdzKSA9PlxuICAgICAgICAgICAgZXhwb3J0cy50YXBQcm9taXNlRm9yKHRhcGFibGUsIG5hbWUsIC4uLmFyZ3MpLFxuICAgICAgICAgIGNhbGw6ICguLi5hcmdzKSA9PiBleHBvcnRzLmNhbGxGb3IodGFwYWJsZSwgbmFtZSwgLi4uYXJncyksXG4gICAgICAgICAgcHJvbWlzZTogKC4uLmFyZ3MpID0+IGV4cG9ydHMucHJvbWlzZUZvcih0YXBhYmxlLCBuYW1lLCAuLi5hcmdzKSxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhcGFibGUuX19oYXJkU291cmNlX3Byb3h5W25hbWVdID0ge1xuICAgICAgICAgIHRhcDogKC4uLmFyZ3MpID0+IGV4cG9ydHMudGFwKHRhcGFibGUsIG5hbWUsIC4uLmFyZ3MpLFxuICAgICAgICAgIHRhcFByb21pc2U6ICguLi5hcmdzKSA9PiBleHBvcnRzLnRhcFByb21pc2UodGFwYWJsZSwgbmFtZSwgLi4uYXJncyksXG4gICAgICAgICAgY2FsbDogKC4uLmFyZ3MpID0+IGV4cG9ydHMuY2FsbCh0YXBhYmxlLCBuYW1lLCBhcmdzKSxcbiAgICAgICAgICBwcm9taXNlOiAoLi4uYXJncykgPT4gZXhwb3J0cy5wcm9taXNlKHRhcGFibGUsIG5hbWUsIGFyZ3MpLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0cy50YXAgPSAodGFwYWJsZSwgbmFtZSwgcmVhc29uLCBjYWxsYmFjaykgPT4ge1xuICBpZiAodGFwYWJsZS5ob29rcykge1xuICAgIHRhcGFibGUuaG9va3NbbmFtZV0udGFwKHJlYXNvbiwgY2FsbGJhY2spO1xuICB9IGVsc2Uge1xuICAgIGlmICghdGFwYWJsZS5fX2hhcmRTb3VyY2VfaG9va3MgfHwgIXRhcGFibGUuX19oYXJkU291cmNlX2hvb2tzW25hbWVdKSB7XG4gICAgICBjb25zdCByZWdpc3RyYXRpb24gPVxuICAgICAgICBrbm93blBsdWdpblJlZ2lzdHJhdGlvbnNbdGFwYWJsZS5jb25zdHJ1Y3Rvci5uYW1lXVtuYW1lXTtcbiAgICAgIGV4cG9ydHMucmVnaXN0ZXIodGFwYWJsZSwgbmFtZSwgcmVnaXN0cmF0aW9uWzBdLCByZWdpc3RyYXRpb25bMV0pO1xuICAgIH1cbiAgICBjb25zdCBkYXNoTmFtZSA9IHRhcGFibGUuX19oYXJkU291cmNlX2hvb2tzW25hbWVdLmRhc2hOYW1lO1xuICAgIGlmICh0YXBhYmxlLl9faGFyZFNvdXJjZV9ob29rc1tuYW1lXS5hc3luYykge1xuICAgICAgdGFwYWJsZS5wbHVnaW4oZGFzaE5hbWUsICguLi5hcmdzKSA9PiB7XG4gICAgICAgIGNvbnN0IGNiID0gYXJncy5wb3AoKTtcbiAgICAgICAgY2IobnVsbCwgY2FsbGJhY2soLi4uYXJncykpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcGFibGUucGx1Z2luKGRhc2hOYW1lLCBjYWxsYmFjayk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnRzLnRhcFByb21pc2UgPSAodGFwYWJsZSwgbmFtZSwgcmVhc29uLCBjYWxsYmFjaykgPT4ge1xuICBpZiAodGFwYWJsZS5ob29rcykge1xuICAgIHRhcGFibGUuaG9va3NbbmFtZV0udGFwUHJvbWlzZShyZWFzb24sIGNhbGxiYWNrKTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoIXRhcGFibGUuX19oYXJkU291cmNlX2hvb2tzIHx8ICF0YXBhYmxlLl9faGFyZFNvdXJjZV9ob29rc1tuYW1lXSkge1xuICAgICAgY29uc3QgcmVnaXN0cmF0aW9uID1cbiAgICAgICAga25vd25QbHVnaW5SZWdpc3RyYXRpb25zW3RhcGFibGUuY29uc3RydWN0b3IubmFtZV1bbmFtZV07XG4gICAgICBleHBvcnRzLnJlZ2lzdGVyKHRhcGFibGUsIG5hbWUsIHJlZ2lzdHJhdGlvblswXSwgcmVnaXN0cmF0aW9uWzFdKTtcbiAgICB9XG4gICAgY29uc3QgZGFzaE5hbWUgPSB0YXBhYmxlLl9faGFyZFNvdXJjZV9ob29rc1tuYW1lXS5kYXNoTmFtZTtcbiAgICB0YXBhYmxlLnBsdWdpbihkYXNoTmFtZSwgKC4uLmFyZ3MpID0+IHtcbiAgICAgIGNvbnN0IGNiID0gYXJncy5wb3AoKTtcbiAgICAgIHJldHVybiBjYWxsYmFjayguLi5hcmdzKS50aGVuKHZhbHVlID0+IGNiKG51bGwsIHZhbHVlKSwgY2IpO1xuICAgIH0pO1xuICB9XG59O1xuXG5leHBvcnRzLnRhcEFzeW5jID0gKHRhcGFibGUsIG5hbWUsIHJlYXNvbiwgY2FsbGJhY2spID0+IHtcbiAgaWYgKHRhcGFibGUuaG9va3MpIHtcbiAgICB0YXBhYmxlLmhvb2tzW25hbWVdLnRhcEFzeW5jKHJlYXNvbiwgY2FsbGJhY2spO1xuICB9IGVsc2Uge1xuICAgIGlmICghdGFwYWJsZS5fX2hhcmRTb3VyY2VfaG9va3MgfHwgIXRhcGFibGUuX19oYXJkU291cmNlX2hvb2tzW25hbWVdKSB7XG4gICAgICBjb25zdCByZWdpc3RyYXRpb24gPVxuICAgICAgICBrbm93blBsdWdpblJlZ2lzdHJhdGlvbnNbdGFwYWJsZS5jb25zdHJ1Y3Rvci5uYW1lXVtuYW1lXTtcbiAgICAgIGV4cG9ydHMucmVnaXN0ZXIodGFwYWJsZSwgbmFtZSwgcmVnaXN0cmF0aW9uWzBdLCByZWdpc3RyYXRpb25bMV0pO1xuICAgIH1cbiAgICBjb25zdCBkYXNoTmFtZSA9IHRhcGFibGUuX19oYXJkU291cmNlX2hvb2tzW25hbWVdLmRhc2hOYW1lO1xuICAgIHRhcGFibGUucGx1Z2luKGRhc2hOYW1lLCBjYWxsYmFjayk7XG4gIH1cbn07XG5cbmV4cG9ydHMuY2FsbCA9ICh0YXBhYmxlLCBuYW1lLCBhcmdzKSA9PiB7XG4gIGlmICh0YXBhYmxlLmhvb2tzKSB7XG4gICAgY29uc3QgaG9vayA9IHRhcGFibGUuaG9va3NbbmFtZV07XG4gICAgcmV0dXJuIGhvb2suY2FsbCguLi5hcmdzKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBkYXNoTmFtZSA9IHRhcGFibGUuX19oYXJkU291cmNlX2hvb2tzW25hbWVdLmRhc2hOYW1lO1xuICAgIGNvbnN0IHN0eWxlID0gdGFwYWJsZS5fX2hhcmRTb3VyY2VfaG9va3NbbmFtZV0uc3R5bGU7XG4gICAgcmV0dXJuIHRhcGFibGVbY2FsbFN0eWxlc1tzdHlsZV1dKC4uLltkYXNoTmFtZV0uY29uY2F0KGFyZ3MpKTtcbiAgfVxufTtcblxuZXhwb3J0cy5wcm9taXNlID0gKHRhcGFibGUsIG5hbWUsIGFyZ3MpID0+IHtcbiAgaWYgKHRhcGFibGUuaG9va3MpIHtcbiAgICBjb25zdCBob29rID0gdGFwYWJsZS5ob29rc1tuYW1lXTtcbiAgICByZXR1cm4gaG9vay5wcm9taXNlKC4uLmFyZ3MpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGRhc2hOYW1lID0gdGFwYWJsZS5fX2hhcmRTb3VyY2VfaG9va3NbbmFtZV0uZGFzaE5hbWU7XG4gICAgY29uc3Qgc3R5bGUgPSB0YXBhYmxlLl9faGFyZFNvdXJjZV9ob29rc1tuYW1lXS5zdHlsZTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGFwYWJsZVtjYWxsU3R5bGVzW3N0eWxlXV0oXG4gICAgICAgIC4uLltkYXNoTmFtZV0uY29uY2F0KGFyZ3MsIChlcnIsIHZhbHVlKSA9PiB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9XG59O1xuXG5leHBvcnRzLnRhcEZvciA9ICh0YXBhYmxlLCBuYW1lLCBrZXksIHJlYXNvbiwgY2FsbGJhY2spID0+IHtcbiAgaWYgKHRhcGFibGUuaG9va3MpIHtcbiAgICB0YXBhYmxlLmhvb2tzW25hbWVdLmZvcihrZXkpLnRhcChyZWFzb24sIGNhbGxiYWNrKTtcbiAgfSBlbHNlIHtcbiAgICBleHBvcnRzLnRhcCh0YXBhYmxlLCBuYW1lLCByZWFzb24sIGNhbGxiYWNrKTtcbiAgfVxufTtcblxuZXhwb3J0cy50YXBQcm9taXNlRm9yID0gKHRhcGFibGUsIG5hbWUsIGtleSwgcmVhc29uLCBjYWxsYmFjaykgPT4ge1xuICBpZiAodGFwYWJsZS5ob29rcykge1xuICAgIHRhcGFibGUuaG9va3NbbmFtZV0uZm9yKGtleSkudGFwUHJvbWlzZShyZWFzb24sIGNhbGxiYWNrKTtcbiAgfSBlbHNlIHtcbiAgICBleHBvcnRzLnRhcFByb21pc2UodGFwYWJsZSwgbmFtZSwgcmVhc29uLCBjYWxsYmFjayk7XG4gIH1cbn07XG5cbmV4cG9ydHMuY2FsbEZvciA9ICh0YXBhYmxlLCBuYW1lLCBrZXksIGFyZ3MpID0+IHtcbiAgaWYgKHRhcGFibGUuaG9va3MpIHtcbiAgICB0YXBhYmxlLmhvb2tzW25hbWVdLmZvcihrZXkpLmNhbGwoLi4uYXJncyk7XG4gIH0gZWxzZSB7XG4gICAgZXhwb3J0cy5jYWxsKHRhcGFibGUsIG5hbWUsIGFyZ3MpO1xuICB9XG59O1xuXG5leHBvcnRzLnByb21pc2VGb3IgPSAodGFwYWJsZSwgbmFtZSwga2V5LCBhcmdzKSA9PiB7XG4gIGlmICh0YXBhYmxlLmhvb2tzKSB7XG4gICAgdGFwYWJsZS5ob29rc1tuYW1lXS5mb3Ioa2V5KS5wcm9taXNlKC4uLmFyZ3MpO1xuICB9IGVsc2Uge1xuICAgIGV4cG9ydHMucHJvbWlzZSh0YXBhYmxlLCBuYW1lLCBhcmdzKTtcbiAgfVxufTtcblxuZXhwb3J0cy5ob29rcyA9IHRhcGFibGUgPT4ge1xuICBpZiAodGFwYWJsZS5ob29rcykge1xuICAgIHJldHVybiB0YXBhYmxlLmhvb2tzO1xuICB9XG4gIGlmICghdGFwYWJsZS5fX2hhcmRTb3VyY2VfcHJveHkpIHtcbiAgICB0YXBhYmxlLl9faGFyZFNvdXJjZV9wcm94eSA9IHt9O1xuICB9XG4gIGNvbnN0IHJlZ2lzdHJhdGlvbnMgPSBrbm93blBsdWdpblJlZ2lzdHJhdGlvbnNbdGFwYWJsZS5jb25zdHJ1Y3Rvci5uYW1lXTtcbiAgaWYgKHJlZ2lzdHJhdGlvbnMpIHtcbiAgICBmb3IgKGNvbnN0IG5hbWUgaW4gcmVnaXN0cmF0aW9ucykge1xuICAgICAgY29uc3QgcmVnaXN0cmF0aW9uID0gcmVnaXN0cmF0aW9uc1tuYW1lXTtcbiAgICAgIGV4cG9ydHMucmVnaXN0ZXIodGFwYWJsZSwgbmFtZSwgcmVnaXN0cmF0aW9uWzBdLCByZWdpc3RyYXRpb25bMV0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdGFwYWJsZS5fX2hhcmRTb3VyY2VfcHJveHk7XG59O1xuIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvdHlsZXJhcmJ1cy9kZXYvcHJvdmlkZXIvc3JjIn0=
