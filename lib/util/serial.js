'use strict';

require('source-map-support/register');

const relateContext = require('./relate-context');

const pipe = exports.pipe = (...fns) => ({
  freeze(arg, module, extra, methods) {
    for (const fn of fns) {
      arg = fn.freeze(arg, module, extra, methods);
    }
    return arg;
  },
  thaw(arg, frozen, extra, methods) {
    for (const fn of fns) {
      arg = fn.thaw(arg, frozen, extra, methods);
    }
    return arg;
  }
});

const contextual = exports.contextual = fnname => {
  const relate = relateContext[`relateNormal${fnname}`];
  const context = relateContext[`contextNormal${fnname}`];
  return {
    freeze: (arg, module, { compilation }, methods) => arg ? relate(compilation.compiler, arg) : arg,
    thaw: (arg, module, { compilation }, methods) => arg ? context(compilation.compiler, arg) : arg
  };
};

const archetype = exports.archetype = type => ({
  freeze: (arg, module, extra, { freeze }) => freeze(type, null, arg, extra),
  thaw: (arg, module, extra, { thaw }) => thaw(type, null, arg, extra)
});
const mapArchetype = exports.mapArchetype = type => ({
  freeze: (arg, module, extra, { mapFreeze }) => mapFreeze(type, null, arg, extra),
  thaw: (arg, module, extra, { mapThaw }) => mapThaw(type, null, arg, extra)
});

const path = exports.path = contextual('Path');
const pathArray = exports.pathArray = contextual('PathArray');
const pathSet = exports.pathSet = contextual('PathSet');
const request = exports.request = contextual('Request');
const _loaders = exports._loaders = contextual('Loaders');
const loaders = exports.loaders = {
  freeze: _loaders.freeze,
  thaw(arg, frozen, extra, methods) {
    return _loaders.thaw(arg, frozen, extra, methods).map(loader => {
      if (loader.ident) {
        return {
          loader: loader.loader,
          ident: loader.ident,
          options: extra.normalModuleFactory.ruleSet.findOptionsByIdent(loader.ident)
        };
      }
      return loader;
    });
  }
};
const regExp = exports.regExp = {
  freeze: arg => arg ? arg.source : false,
  thaw: arg => arg ? new RegExp(arg) : false
};

const parser = exports.parser = archetype('Parser');
const generator = exports.generator = archetype('Generator');
const source = exports.source = archetype('Source');
const moduleAssets = exports.moduleAssets = archetype('ModuleAssets');
const moduleError = exports.moduleError = mapArchetype('ModuleError');
const moduleWarning = exports.moduleWarning = mapArchetype('ModuleWarning');
const dependencyBlock = exports.dependencyBlock = {
  freeze: (arg, module, extra, { freeze }) => freeze('DependencyBlock', null, arg, extra),
  thaw: (arg, module, extra, { thaw }) => thaw('DependencyBlock', arg, module, extra)
};

const _null = exports.null = {
  freeze: () => null,
  thaw: () => null
};
const identity = exports.identity = {
  freeze: (arg, module, extra, methods) => arg,
  thaw: (arg, module, extra, methods) => arg
};

const assigned = exports.assigned = members => ({
  freeze(arg, module, extra, methods) {
    const out = {};
    for (const key in members) {
      out[key] = members[key].freeze(arg[key], module, extra, methods);
    }
    return out;
  },
  thaw(arg, frozen, extra, methods) {
    for (const key in members) {
      arg[key] = members[key].thaw(frozen[key], frozen, extra, methods);
    }
    return arg;
  }
});

const created = exports.created = members => ({
  freeze(arg, module, extra, methods) {
    if (!arg) {
      return null;
    }
    const out = {};
    for (const key in members) {
      out[key] = members[key].freeze(arg[key], module, extra, methods);
    }
    return out;
  },
  thaw(arg, frozen, extra, methods) {
    if (!arg) {
      return null;
    }
    const out = {};
    for (const key in members) {
      out[key] = members[key].thaw(arg[key], frozen, extra, methods);
    }
    return out;
  }
});

const constructed = exports.constructed = (Type, args) => ({
  freeze(arg, module, extra, methods) {
    const out = {};
    for (const key in args) {
      out[key] = args[key].freeze(arg[key], module, extra, methods);
    }
    return out;
  },
  thaw(arg, frozen, extra, methods) {
    const newArgs = [];
    for (const key in args) {
      newArgs.push(args[key].thaw(frozen[key], frozen, extra, methods));
    }
    return new Type(...newArgs);
  }
});

const serial = exports.serial = (name, stages) => ({
  freeze(arg, module, extra, methods) {
    const out = {
      type: name
    };
    for (const key in stages) {
      out[key] = stages[key].freeze(module, module, extra, methods);
    }
    return out;
  },
  thaw(arg, frozen, extra, methods) {
    let out;
    for (const key in stages) {
      out = stages[key].thaw(out, frozen[key], extra, methods);
    }
    return out;
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi91dGlsL3NlcmlhbC5qcyJdLCJuYW1lcyI6WyJyZWxhdGVDb250ZXh0IiwicmVxdWlyZSIsInBpcGUiLCJleHBvcnRzIiwiZm5zIiwiZnJlZXplIiwiYXJnIiwibW9kdWxlIiwiZXh0cmEiLCJtZXRob2RzIiwiZm4iLCJ0aGF3IiwiZnJvemVuIiwiY29udGV4dHVhbCIsImZubmFtZSIsInJlbGF0ZSIsImNvbnRleHQiLCJjb21waWxhdGlvbiIsImNvbXBpbGVyIiwiYXJjaGV0eXBlIiwidHlwZSIsIm1hcEFyY2hldHlwZSIsIm1hcEZyZWV6ZSIsIm1hcFRoYXciLCJwYXRoIiwicGF0aEFycmF5IiwicGF0aFNldCIsInJlcXVlc3QiLCJfbG9hZGVycyIsImxvYWRlcnMiLCJtYXAiLCJsb2FkZXIiLCJpZGVudCIsIm9wdGlvbnMiLCJub3JtYWxNb2R1bGVGYWN0b3J5IiwicnVsZVNldCIsImZpbmRPcHRpb25zQnlJZGVudCIsInJlZ0V4cCIsInNvdXJjZSIsIlJlZ0V4cCIsInBhcnNlciIsImdlbmVyYXRvciIsIm1vZHVsZUFzc2V0cyIsIm1vZHVsZUVycm9yIiwibW9kdWxlV2FybmluZyIsImRlcGVuZGVuY3lCbG9jayIsIl9udWxsIiwibnVsbCIsImlkZW50aXR5IiwiYXNzaWduZWQiLCJtZW1iZXJzIiwib3V0Iiwia2V5IiwiY3JlYXRlZCIsImNvbnN0cnVjdGVkIiwiVHlwZSIsImFyZ3MiLCJuZXdBcmdzIiwicHVzaCIsInNlcmlhbCIsIm5hbWUiLCJzdGFnZXMiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNQSxnQkFBZ0JDLFFBQVEsa0JBQVIsQ0FBdEI7O0FBRUEsTUFBTUMsT0FBUUMsUUFBUUQsSUFBUixHQUFlLENBQUMsR0FBR0UsR0FBSixNQUFhO0FBQ3hDQyxTQUFPQyxHQUFQLEVBQVlDLE1BQVosRUFBb0JDLEtBQXBCLEVBQTJCQyxPQUEzQixFQUFvQztBQUNsQyxTQUFLLE1BQU1DLEVB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QyxFQUEwQ0MsT0FBMUMsQ0FBWDtBQUNEO0FBQ0QsV0FBTzBDLEdBQVA7QUFDRCxHQVRpRDtBQVVsRHhDLE9BQUtMLEdBQUwsRUFBVU0sTUFBVixFQUFrQkosS0FBbEIsRUFBeUJDLE9BQXpCLEVBQWtDO0FBQ2hDLFFBQUkwQyxHQUFKO0FBQ0EsU0FBSyxNQUFNQyxHQUFYLElBQWtCUyxNQUFsQixFQUEwQjtBQUN4QlYsWUFBTVUsT0FBT1QsR0FBUCxFQUFZekMsSUFBWixDQUFpQndDLEdBQWpCLEVBQXNCdkMsT0FBT3dDLEdBQVAsQ0FBdEIsRUFBbUM1QyxLQUFuQyxFQUEwQ0MsT0FBMUMsQ0FBTjtBQUNEO0FBQ0QsV0FBTzBDLEdBQVA7QUFDRDtBQWhCaUQsQ0FBbkIsQ0FBakMiLCJmaWxlIjoiaGFyZC1zb3VyY2Utd2VicGFjay1wbHVnaW4vbGliL3V0aWwvc2VyaWFsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcmVsYXRlQ29udGV4dCA9IHJlcXVpcmUoJy4vcmVsYXRlLWNvbnRleHQnKTtcblxuY29uc3QgcGlwZSA9IChleHBvcnRzLnBpcGUgPSAoLi4uZm5zKSA9PiAoe1xuICBmcmVlemUoYXJnLCBtb2R1bGUsIGV4dHJhLCBtZXRob2RzKSB7XG4gICAgZm9yIChjb25zdCBmbiBvZiBmbnMpIHtcbiAgICAgIGFyZyA9IGZuLmZyZWV6ZShhcmcsIG1vZHVsZSwgZXh0cmEsIG1ldGhvZHMpO1xuICAgIH1cbiAgICByZXR1cm4gYXJnO1xuICB9LFxuICB0aGF3KGFyZywgZnJvemVuLCBleHRyYSwgbWV0aG9kcykge1xuICAgIGZvciAoY29uc3QgZm4gb2YgZm5zKSB7XG4gICAgICBhcmcgPSBmbi50aGF3KGFyZywgZnJvemVuLCBleHRyYSwgbWV0aG9kcyk7XG4gICAgfVxuICAgIHJldHVybiBhcmc7XG4gIH0sXG59KSk7XG5cbmNvbnN0IGNvbnRleHR1YWwgPSAoZXhwb3J0cy5jb250ZXh0dWFsID0gZm5uYW1lID0+IHtcbiAgY29uc3QgcmVsYXRlID0gcmVsYXRlQ29udGV4dFtgcmVsYXRlTm9ybWFsJHtmbm5hbWV9YF07XG4gIGNvbnN0IGNvbnRleHQgPSByZWxhdGVDb250ZXh0W2Bjb250ZXh0Tm9ybWFsJHtmbm5hbWV9YF07XG4gIHJldHVybiB7XG4gICAgZnJlZXplOiAoYXJnLCBtb2R1bGUsIHsgY29tcGlsYXRpb24gfSwgbWV0aG9kcykgPT5cbiAgICAgIGFyZyA/IHJlbGF0ZShjb21waWxhdGlvbi5jb21waWxlciwgYXJnKSA6IGFyZyxcbiAgICB0aGF3OiAoYXJnLCBtb2R1bGUsIHsgY29tcGlsYXRpb24gfSwgbWV0aG9kcykgPT5cbiAgICAgIGFyZyA/IGNvbnRleHQoY29tcGlsYXRpb24uY29tcGlsZXIsIGFyZykgOiBhcmcsXG4gIH07XG59KTtcblxuY29uc3QgYXJjaGV0eXBlID0gKGV4cG9ydHMuYXJjaGV0eXBlID0gdHlwZSA9PiAoe1xuICBmcmVlemU6IChhcmcsIG1vZHVsZSwgZXh0cmEsIHsgZnJlZXplIH0pID0+IGZyZWV6ZSh0eXBlLCBudWxsLCBhcmcsIGV4dHJhKSxcbiAgdGhhdzogKGFyZywgbW9kdWxlLCBleHRyYSwgeyB0aGF3IH0pID0+IHRoYXcodHlwZSwgbnVsbCwgYXJnLCBleHRyYSksXG59KSk7XG5jb25zdCBtYXBBcmNoZXR5cGUgPSAoZXhwb3J0cy5tYXBBcmNoZXR5cGUgPSB0eXBlID0+ICh7XG4gIGZyZWV6ZTogKGFyZywgbW9kdWxlLCBleHRyYSwgeyBtYXBGcmVlemUgfSkgPT5cbiAgICBtYXBGcmVlemUodHlwZSwgbnVsbCwgYXJnLCBleHRyYSksXG4gIHRoYXc6IChhcmcsIG1vZHVsZSwgZXh0cmEsIHsgbWFwVGhhdyB9KSA9PiBtYXBUaGF3KHR5cGUsIG51bGwsIGFyZywgZXh0cmEpLFxufSkpO1xuXG5jb25zdCBwYXRoID0gKGV4cG9ydHMucGF0aCA9IGNvbnRleHR1YWwoJ1BhdGgnKSk7XG5jb25zdCBwYXRoQXJyYXkgPSAoZXhwb3J0cy5wYXRoQXJyYXkgPSBjb250ZXh0dWFsKCdQYXRoQXJyYXknKSk7XG5jb25zdCBwYXRoU2V0ID0gKGV4cG9ydHMucGF0aFNldCA9IGNvbnRleHR1YWwoJ1BhdGhTZXQnKSk7XG5jb25zdCByZXF1ZXN0ID0gKGV4cG9ydHMucmVxdWVzdCA9IGNvbnRleHR1YWwoJ1JlcXVlc3QnKSk7XG5jb25zdCBfbG9hZGVycyA9IChleHBvcnRzLl9sb2FkZXJzID0gY29udGV4dHVhbCgnTG9hZGVycycpKTtcbmNvbnN0IGxvYWRlcnMgPSAoZXhwb3J0cy5sb2FkZXJzID0ge1xuICBmcmVlemU6IF9sb2FkZXJzLmZyZWV6ZSxcbiAgdGhhdyhhcmcsIGZyb3plbiwgZXh0cmEsIG1ldGhvZHMpIHtcbiAgICByZXR1cm4gX2xvYWRlcnMudGhhdyhhcmcsIGZyb3plbiwgZXh0cmEsIG1ldGhvZHMpLm1hcChsb2FkZXIgPT4ge1xuICAgICAgaWYgKGxvYWRlci5pZGVudCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGxvYWRlcjogbG9hZGVyLmxvYWRlcixcbiAgICAgICAgICBpZGVudDogbG9hZGVyLmlkZW50LFxuICAgICAgICAgIG9wdGlvbnM6IGV4dHJhLm5vcm1hbE1vZHVsZUZhY3RvcnkucnVsZVNldC5maW5kT3B0aW9uc0J5SWRlbnQoXG4gICAgICAgICAgICBsb2FkZXIuaWRlbnQsXG4gICAgICAgICAgKSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBsb2FkZXI7XG4gICAgfSk7XG4gIH0sXG59KTtcbmNvbnN0IHJlZ0V4cCA9IChleHBvcnRzLnJlZ0V4cCA9IHtcbiAgZnJlZXplOiBhcmcgPT4gKGFyZyA/IGFyZy5zb3VyY2UgOiBmYWxzZSksXG4gIHRoYXc6IGFyZyA9PiAoYXJnID8gbmV3IFJlZ0V4cChhcmcpIDogZmFsc2UpLFxufSk7XG5cbmNvbnN0IHBhcnNlciA9IChleHBvcnRzLnBhcnNlciA9IGFyY2hldHlwZSgnUGFyc2VyJykpO1xuY29uc3QgZ2VuZXJhdG9yID0gKGV4cG9ydHMuZ2VuZXJhdG9yID0gYXJjaGV0eXBlKCdHZW5lcmF0b3InKSk7XG5jb25zdCBzb3VyY2UgPSAoZXhwb3J0cy5zb3VyY2UgPSBhcmNoZXR5cGUoJ1NvdXJjZScpKTtcbmNvbnN0IG1vZHVsZUFzc2V0cyA9IChleHBvcnRzLm1vZHVsZUFzc2V0cyA9IGFyY2hldHlwZSgnTW9kdWxlQXNzZXRzJykpO1xuY29uc3QgbW9kdWxlRXJyb3IgPSAoZXhwb3J0cy5tb2R1bGVFcnJvciA9IG1hcEFyY2hldHlwZSgnTW9kdWxlRXJyb3InKSk7XG5jb25zdCBtb2R1bGVXYXJuaW5nID0gKGV4cG9ydHMubW9kdWxlV2FybmluZyA9IG1hcEFyY2hldHlwZSgnTW9kdWxlV2FybmluZycpKTtcbmNvbnN0IGRlcGVuZGVuY3lCbG9jayA9IChleHBvcnRzLmRlcGVuZGVuY3lCbG9jayA9IHtcbiAgZnJlZXplOiAoYXJnLCBtb2R1bGUsIGV4dHJhLCB7IGZyZWV6ZSB9KSA9PlxuICAgIGZyZWV6ZSgnRGVwZW5kZW5jeUJsb2NrJywgbnVsbCwgYXJnLCBleHRyYSksXG4gIHRoYXc6IChhcmcsIG1vZHVsZSwgZXh0cmEsIHsgdGhhdyB9KSA9PlxuICAgIHRoYXcoJ0RlcGVuZGVuY3lCbG9jaycsIGFyZywgbW9kdWxlLCBleHRyYSksXG59KTtcblxuY29uc3QgX251bGwgPSAoZXhwb3J0cy5udWxsID0ge1xuICBmcmVlemU6ICgpID0+IG51bGwsXG4gIHRoYXc6ICgpID0+IG51bGwsXG59KTtcbmNvbnN0IGlkZW50aXR5ID0gKGV4cG9ydHMuaWRlbnRpdHkgPSB7XG4gIGZyZWV6ZTogKGFyZywgbW9kdWxlLCBleHRyYSwgbWV0aG9kcykgPT4gYXJnLFxuICB0aGF3OiAoYXJnLCBtb2R1bGUsIGV4dHJhLCBtZXRob2RzKSA9PiBhcmcsXG59KTtcblxuY29uc3QgYXNzaWduZWQgPSAoZXhwb3J0cy5hc3NpZ25lZCA9IG1lbWJlcnMgPT4gKHtcbiAgZnJlZXplKGFyZywgbW9kdWxlLCBleHRyYSwgbWV0aG9kcykge1xuICAgIGNvbnN0IG91dCA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIG1lbWJlcnMpIHtcbiAgICAgIG91dFtrZXldID0gbWVtYmVyc1trZXldLmZyZWV6ZShhcmdba2V5XSwgbW9kdWxlLCBleHRyYSwgbWV0aG9kcyk7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH0sXG4gIHRoYXcoYXJnLCBmcm96ZW4sIGV4dHJhLCBtZXRob2RzKSB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gbWVtYmVycykge1xuICAgICAgYXJnW2tleV0gPSBtZW1iZXJzW2tleV0udGhhdyhmcm96ZW5ba2V5XSwgZnJvemVuLCBleHRyYSwgbWV0aG9kcyk7XG4gICAgfVxuICAgIHJldHVybiBhcmc7XG4gIH0sXG59KSk7XG5cbmNvbnN0IGNyZWF0ZWQgPSAoZXhwb3J0cy5jcmVhdGVkID0gbWVtYmVycyA9PiAoe1xuICBmcmVlemUoYXJnLCBtb2R1bGUsIGV4dHJhLCBtZXRob2RzKSB7XG4gICAgaWYgKCFhcmcpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBvdXQgPSB7fTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBtZW1iZXJzKSB7XG4gICAgICBvdXRba2V5XSA9IG1lbWJlcnNba2V5XS5mcmVlemUoYXJnW2tleV0sIG1vZHVsZSwgZXh0cmEsIG1ldGhvZHMpO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xuICB9LFxuICB0aGF3KGFyZywgZnJvemVuLCBleHRyYSwgbWV0aG9kcykge1xuICAgIGlmICghYXJnKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3Qgb3V0ID0ge307XG4gICAgZm9yIChjb25zdCBrZXkgaW4gbWVtYmVycykge1xuICAgICAgb3V0W2tleV0gPSBtZW1iZXJzW2tleV0udGhhdyhhcmdba2V5XSwgZnJvemVuLCBleHRyYSwgbWV0aG9kcyk7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH0sXG59KSk7XG5cbmNvbnN0IGNvbnN0cnVjdGVkID0gKGV4cG9ydHMuY29uc3RydWN0ZWQgPSAoVHlwZSwgYXJncykgPT4gKHtcbiAgZnJlZXplKGFyZywgbW9kdWxlLCBleHRyYSwgbWV0aG9kcykge1xuICAgIGNvbnN0IG91dCA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIGFyZ3MpIHtcbiAgICAgIG91dFtrZXldID0gYXJnc1trZXldLmZyZWV6ZShhcmdba2V5XSwgbW9kdWxlLCBleHRyYSwgbWV0aG9kcyk7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH0sXG4gIHRoYXcoYXJnLCBmcm96ZW4sIGV4dHJhLCBtZXRob2RzKSB7XG4gICAgY29uc3QgbmV3QXJncyA9IFtdO1xuICAgIGZvciAoY29uc3Qga2V5IGluIGFyZ3MpIHtcbiAgICAgIG5ld0FyZ3MucHVzaChhcmdzW2tleV0udGhhdyhmcm96ZW5ba2V5XSwgZnJvemVuLCBleHRyYSwgbWV0aG9kcykpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFR5cGUoLi4ubmV3QXJncyk7XG4gIH0sXG59KSk7XG5cbmNvbnN0IHNlcmlhbCA9IChleHBvcnRzLnNlcmlhbCA9IChuYW1lLCBzdGFnZXMpID0+ICh7XG4gIGZyZWV6ZShhcmcsIG1vZHVsZSwgZXh0cmEsIG1ldGhvZHMpIHtcbiAgICBjb25zdCBvdXQgPSB7XG4gICAgICB0eXBlOiBuYW1lLFxuICAgIH07XG4gICAgZm9yIChjb25zdCBrZXkgaW4gc3RhZ2VzKSB7XG4gICAgICBvdXRba2V5XSA9IHN0YWdlc1trZXldLmZyZWV6ZShtb2R1bGUsIG1vZHVsZSwgZXh0cmEsIG1ldGhvZHMpO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xuICB9LFxuICB0aGF3KGFyZywgZnJvemVuLCBleHRyYSwgbWV0aG9kcykge1xuICAgIGxldCBvdXQ7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gc3RhZ2VzKSB7XG4gICAgICBvdXQgPSBzdGFnZXNba2V5XS50aGF3KG91dCwgZnJvemVuW2tleV0sIGV4dHJhLCBtZXRob2RzKTtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbiAgfSxcbn0pKTtcbiJdLCJzb3VyY2VSb290IjoiL1VzZXJzL3R5bGVyYXJidXMvZGV2L3Byb3ZpZGVyL3NyYyJ9
