'use strict';

require('source-map-support/register');

const crypto = require('crypto');
const path = require('path');

const nodeObjectHash = require('node-object-hash');

const sort = nodeObjectHash({
  sort: false
}).sort;

function relateContextToCacheDir(config) {
  const hardSourcePlugin = config.plugins.find(({ constructor }) => constructor.name === 'HardSourceWebpackPlugin');
  const cacheDir = hardSourcePlugin.getCachePath();
  const context = path.resolve(process.cwd(), config.context);
  const clone = Object.assign({}, config, {
    context: path.relative(cacheDir, context)
  });
  const sorted = sort(clone).replace(new RegExp(`${context}[^,\\]}]*`, 'g'), match => path.relative(cacheDir, match)).replace(/\\/g, '/');
  return crypto.createHash('sha256').update(sorted).digest('hex');
}

module.exports = relateContextToCacheDir;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi9kZWZhdWx0Q29uZmlnSGFzaC5qcyJdLCJuYW1lcyI6WyJjcnlwdG8iLCJyZXF1aXJlIiwicGF0aCIsIm5vZGVPYmplY3RIYXNoIiwic29ydCIsInJlbGF0ZUNvbnRleHRUb0NhY2hlRGlyIiwiY29uZmlnIiwiaGFyZFNvdXJjZVBsdWdpbiIsInBsdWdpbnMiLCJmaW5kIiwiY29uc3RydWN0b3IiLCJuYW1lIiwiY2FjaGVEaXIiLCJnZXRDYWNoZVBhdGgiLCJjb250ZXh0IiwicmVzb2x2ZSIsInByb2Nlc3MiLCJjd2QiLCJjbG9uZSIsIk9iamVjdCIsImFzc2lnbiIsInJlbGF0aXZlIiwic29ydGVkIiwicmVwbGFjZSIsIlJlZ0V4cCIsIm1hdGNoIiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNQSxTQUFTQyxRQUFRLFFBQVIsQ0FBZjtBQUNBLE1BQU1DLE9BQU9ELFFBQVEsTUFBUixDQUFiOztBQUVBLE1BQU1FLGlCQUFpQkYsUUFBUSxrQkFBUixDQUF2Qjs7QUFFQSxNQUFNRyxPQUFPRCxlQUFlO0FBQzFCQyxRQUFNO0FBRG9CLENBQWYsRUFFVkEsSUFGSDs7QUFJQSxTQUFTQyx1QkFBVCxDQUFpQ0MsTUFBakMsRUFBeUM7QUFDdkMsUUFBTUMsbUJBQW1CRCxPQUFPRSxPQUFQLENBQWVDLElBQWYsQ0FDdkIsQ0FBQyxFQUFFQyxXQUFGLEVBQUQsS0FBcUJBLFlBQVlDLElBQVosS0FBcUIseUJBRG5CLENBQXpCO0FBR0EsUUFBTUMsV0FBV0wsaUJBQWlCTSxZQUFqQixFQUFqQjtBQUNBLFFBQU1DLFVBQVVaLEtBQUthLE9BQUwsQ0FBYUMsUUFBUUMsR0FBUixFQUFiLEVBQTRCWCxPQUFPUSxPQUFuQyxDQUFoQjtBQUNBLFFBQU1JLFFBQVFDLE9BQU9DLE1BQVAsQ0FBYyxFQUFkLEVBQWtCZCxNQUFsQixFQUEwQjtBQUN0Q1EsYUFBU1osS0FBS21CLFFBQUwsQ0FBY1QsUUFBZCxFQUF3QkUsT0FBeEI7QUFENkIsR0FBMUIsQ0FBZDtBQUdBLFFBQU1RLFNBQVNsQixLQUFLYyxLQUFMLEVBQ1pLLE9BRFksQ0FDSixJQUFJQyxNQUFKLENBQVksR0FBRVYsT0FBUSxXQUF0QixFQUFrQyxHQUFsQyxDQURJLEVBQ29DVyxTQUMvQ3ZCLEtBQUttQixRQUFMLENBQWNULFFBQWQsRUFBd0JhLEtBQXhCLENBRlcsRUFJWkYsT0FKWSxDQUlKLEtBSkksRUFJRyxHQUpILENBQWY7QUFLQSxTQUFPdkIsT0FDSjBCLFVBREksQ0FDTyxRQURQLEVBRUpDLE1BRkksQ0FFR0wsTUFGSCxFQUdKTSxNQUhJLENBR0csS0FISCxDQUFQO0FBSUQ7O0FBRURDLE9BQU9DLE9BQVAsR0FBaUJ6Qix1QkFBakIiLCJmaWxlIjoiaGFyZC1zb3VyY2Utd2VicGFjay1wbHVnaW4vbGliL2RlZmF1bHRDb25maWdIYXNoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7XG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG5jb25zdCBub2RlT2JqZWN0SGFzaCA9IHJlcXVpcmUoJ25vZGUtb2JqZWN0LWhhc2gnKTtcblxuY29uc3Qgc29ydCA9IG5vZGVPYmplY3RIYXNoKHtcbiAgc29ydDogZmFsc2UsXG59KS5zb3J0O1xuXG5mdW5jdGlvbiByZWxhdGVDb250ZXh0VG9DYWNoZURpcihjb25maWcpIHtcbiAgY29uc3QgaGFyZFNvdXJjZVBsdWdpbiA9IGNvbmZpZy5wbHVnaW5zLmZpbmQoXG4gICAgKHsgY29uc3RydWN0b3IgfSkgPT4gY29uc3RydWN0b3IubmFtZSA9PT0gJ0hhcmRTb3VyY2VXZWJwYWNrUGx1Z2luJyxcbiAgKTtcbiAgY29uc3QgY2FjaGVEaXIgPSBoYXJkU291cmNlUGx1Z2luLmdldENhY2hlUGF0aCgpO1xuICBjb25zdCBjb250ZXh0ID0gcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIGNvbmZpZy5jb250ZXh0KTtcbiAgY29uc3QgY2xvbmUgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWcsIHtcbiAgICBjb250ZXh0OiBwYXRoLnJlbGF0aXZlKGNhY2hlRGlyLCBjb250ZXh0KSxcbiAgfSk7XG4gIGNvbnN0IHNvcnRlZCA9IHNvcnQoY2xvbmUpXG4gICAgLnJlcGxhY2UobmV3IFJlZ0V4cChgJHtjb250ZXh0fVteLFxcXFxdfV0qYCwgJ2cnKSwgbWF0Y2ggPT5cbiAgICAgIHBhdGgucmVsYXRpdmUoY2FjaGVEaXIsIG1hdGNoKSxcbiAgICApXG4gICAgLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcbiAgcmV0dXJuIGNyeXB0b1xuICAgIC5jcmVhdGVIYXNoKCdzaGEyNTYnKVxuICAgIC51cGRhdGUoc29ydGVkKVxuICAgIC5kaWdlc3QoJ2hleCcpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHJlbGF0ZUNvbnRleHRUb0NhY2hlRGlyO1xuIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvdHlsZXJhcmJ1cy9kZXYvcHJvdmlkZXIvc3JjIn0=
