'use strict';

const join = require('path').join;

const pluginCompat = require('./util/plugin-compat');

let CacacheSerializer;

class SerializerCacachePlugin {
  apply(compiler) {
    pluginCompat.tap(compiler, 'hardSourceCacheFactory', 'CacacheSerializer', factory => info => {
      if (info.type === 'data') {
        return SerializerCacachePlugin.createSerializer(info);
      }
      return factory(info);
    });
  }
}

SerializerCacachePlugin.createSerializer = ({ cacheDirPath, name }) => {
  if (!CacacheSerializer) {
    CacacheSerializer = require('./SerializerCacache');
  }

  return new CacacheSerializer({
    cacheDirPath: join(cacheDirPath, name)
  });
};

module.exports = SerializerCacachePlugin;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi9TZXJpYWxpemVyQ2FjYWNoZVBsdWdpbi5qcyJdLCJuYW1lcyI6WyJqb2luIiwicmVxdWlyZSIsInBsdWdpbkNvbXBhdCIsIkNhY2FjaGVTZXJpYWxpemVyIiwiU2VyaWFsaXplckNhY2FjaGVQbHVnaW4iLCJhcHBseSIsImNvbXBpbGVyIiwidGFwIiwiZmFjdG9yeSIsImluZm8iLCJ0eXBlIiwiY3JlYXRlU2VyaWFsaXplciIsImNhY2hlRGlyUGF0aCIsIm5hbWUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLE9BQU9DLFFBQVEsTUFBUixFQUFnQkQsSUFBN0I7O0FBRUEsTUFBTUUsZUFBZUQsK0JBQXJCOztBQUVBLElBQUlFLGlCQUFKOztBQUVBLE1BQU1DLHVCQUFOLENBQThCO0FBQzVCQyxRQUFNQyxRQUFOLEVBQWdCO0FBQ2RKLGlCQUFhSyxHQUFiLENBQ0VELFFBREYsRUFFRSx3QkFGRixFQUdFLG1CQUhGLEVBSUVFLFdBQVdDLFFBQVE7QUFDakIsVUFBSUEsS0FBS0MsSUFBTCxLQUFjLE1BQWxCLEVBQTBCO0FBQ3hCLGVBQU9OLHdCQUF3Qk8sZ0JBQXhCLENBQXlDRixJQUF6QyxDQUFQO0FBQ0Q7QUFDRCxhQUFPRCxRQUFRQyxJQUFSLENBQVA7QUFDRCxLQVRIO0FBV0Q7QUFiMkI7O0FBZ0I5Qkwsd0JBQXdCTyxnQkFBeEIsR0FBMkMsQ0FBQyxFQUFFQyxZQUFGLEVBQWdCQyxJQUFoQixFQUFELEtBQTRCO0FBQ3JFLE1BQUksQ0FBQ1YsaUJBQUwsRUFBd0I7QUFDdEJBLHdCQUFvQkYsOEJBQXBCO0FBQ0Q7O0FBRUQsU0FBTyxJQUFJRSxpQkFBSixDQUFzQjtBQUMzQlMsa0JBQWNaLEtBQUtZLFlBQUwsRUFBbUJDLElBQW5CO0FBRGEsR0FBdEIsQ0FBUDtBQUdELENBUkQ7O0FBVUFDLE9BQU9DLE9BQVAsR0FBaUJYLHVCQUFqQiIsImZpbGUiOiJoYXJkLXNvdXJjZS13ZWJwYWNrLXBsdWdpbi9saWIvU2VyaWFsaXplckNhY2FjaGVQbHVnaW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBqb2luID0gcmVxdWlyZSgncGF0aCcpLmpvaW47XG5cbmNvbnN0IHBsdWdpbkNvbXBhdCA9IHJlcXVpcmUoJy4vdXRpbC9wbHVnaW4tY29tcGF0Jyk7XG5cbmxldCBDYWNhY2hlU2VyaWFsaXplcjtcblxuY2xhc3MgU2VyaWFsaXplckNhY2FjaGVQbHVnaW4ge1xuICBhcHBseShjb21waWxlcikge1xuICAgIHBsdWdpbkNvbXBhdC50YXAoXG4gICAgICBjb21waWxlcixcbiAgICAgICdoYXJkU291cmNlQ2FjaGVGYWN0b3J5JyxcbiAgICAgICdDYWNhY2hlU2VyaWFsaXplcicsXG4gICAgICBmYWN0b3J5ID0+IGluZm8gPT4ge1xuICAgICAgICBpZiAoaW5mby50eXBlID09PSAnZGF0YScpIHtcbiAgICAgICAgICByZXR1cm4gU2VyaWFsaXplckNhY2FjaGVQbHVnaW4uY3JlYXRlU2VyaWFsaXplcihpbmZvKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFjdG9yeShpbmZvKTtcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxufVxuXG5TZXJpYWxpemVyQ2FjYWNoZVBsdWdpbi5jcmVhdGVTZXJpYWxpemVyID0gKHsgY2FjaGVEaXJQYXRoLCBuYW1lIH0pID0+IHtcbiAgaWYgKCFDYWNhY2hlU2VyaWFsaXplcikge1xuICAgIENhY2FjaGVTZXJpYWxpemVyID0gcmVxdWlyZSgnLi9TZXJpYWxpemVyQ2FjYWNoZScpO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBDYWNhY2hlU2VyaWFsaXplcih7XG4gICAgY2FjaGVEaXJQYXRoOiBqb2luKGNhY2hlRGlyUGF0aCwgbmFtZSksXG4gIH0pO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTZXJpYWxpemVyQ2FjYWNoZVBsdWdpbjtcbiJdLCJzb3VyY2VSb290IjoiL1VzZXJzL3R5bGVyYXJidXMvZGV2L3Byb3ZpZGVyL3NyYyJ9
