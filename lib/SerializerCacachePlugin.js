'use strict';

require('source-map-support/register');

const join = require('path').join;

const pluginCompat = require('./util/plugin-compat');

let CacacheSerializer;

class SerializerCacachePlugin {
  apply(compiler) {
    pluginCompat.tap(compiler, 'hardSourceCacheFactory', 'CacacheSerializer', factory => info => {
      if (info.type === 'data') {
        return SerializerCacachePlugin.createSerializer(info);
      }
      return factory(info);
    });
  }
}

SerializerCacachePlugin.createSerializer = ({ cacheDirPath, name }) => {
  if (!CacacheSerializer) {
    CacacheSerializer = require('./SerializerCacache');
  }

  return new CacacheSerializer({
    cacheDirPath: join(cacheDirPath, name)
  });
};

module.exports = SerializerCacachePlugin;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi9TZXJpYWxpemVyQ2FjYWNoZVBsdWdpbi5qcyJdLCJuYW1lcyI6WyJqb2luIiwicmVxdWlyZSIsInBsdWdpbkNvbXBhdCIsIkNhY2FjaGVTZXJpYWxpemVyIiwiU2VyaWFsaXplckNhY2FjaGVQbHVnaW4iLCJhcHBseSIsImNvbXBpbGVyIiwidGFwIiwiZmFjdG9yeSIsImluZm8iLCJ0eXBlIiwiY3JlYXRlU2VyaWFsaXplciIsImNhY2hlRGlyUGF0aCIsIm5hbWUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUEsTUFBTUEsT0FBT0MsUUFBUSxNQUFSLEVBQWdCRCxJQUE3Qjs7QUFFQSxNQUFNRSxlQUFlRCxRQUFRLHNCQUFSLENBQXJCOztBQUVBLElBQUlFLGlCQUFKOztBQUVBLE1BQU1DLHVCQUFOLENBQThCO0FBQzVCQyxRQUFNQyxRQUFOLEVBQWdCO0FBQ2RKLGlCQUFhSyxHQUFiLENBQ0VELFFBREYsRUFFRSx3QkFGRixFQUdFLG1CQUhGLEVBSUVFLFdBQVdDLFFBQVE7QUFDakIsVUFBSUEsS0FBS0MsSUFBTCxLQUFjLE1BQWxCLEVBQTBCO0FBQ3hCLGVBQU9OLHdCQUF3Qk8sZ0JBQXhCLENBQXlDRixJQUF6QyxDQUFQO0FBQ0Q7QUFDRCxhQUFPRCxRQUFRQyxJQUFSLENBQVA7QUFDRCxLQVRIO0FBV0Q7QUFiMkI7O0FBZ0I5Qkwsd0JBQXdCTyxnQkFBeEIsR0FBMkMsQ0FBQyxFQUFFQyxZQUFGLEVBQWdCQyxJQUFoQixFQUFELEtBQTRCO0FBQ3JFLE1BQUksQ0FBQ1YsaUJBQUwsRUFBd0I7QUFDdEJBLHdCQUFvQkYsUUFBUSxxQkFBUixDQUFwQjtBQUNEOztBQUVELFNBQU8sSUFBSUUsaUJBQUosQ0FBc0I7QUFDM0JTLGtCQUFjWixLQUFLWSxZQUFMLEVBQW1CQyxJQUFuQjtBQURhLEdBQXRCLENBQVA7QUFHRCxDQVJEOztBQVVBQyxPQUFPQyxPQUFQLEdBQWlCWCx1QkFBakIiLCJmaWxlIjoiaGFyZC1zb3VyY2Utd2VicGFjay1wbHVnaW4vbGliL1NlcmlhbGl6ZXJDYWNhY2hlUGx1Z2luLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgam9pbiA9IHJlcXVpcmUoJ3BhdGgnKS5qb2luO1xuXG5jb25zdCBwbHVnaW5Db21wYXQgPSByZXF1aXJlKCcuL3V0aWwvcGx1Z2luLWNvbXBhdCcpO1xuXG5sZXQgQ2FjYWNoZVNlcmlhbGl6ZXI7XG5cbmNsYXNzIFNlcmlhbGl6ZXJDYWNhY2hlUGx1Z2luIHtcbiAgYXBwbHkoY29tcGlsZXIpIHtcbiAgICBwbHVnaW5Db21wYXQudGFwKFxuICAgICAgY29tcGlsZXIsXG4gICAgICAnaGFyZFNvdXJjZUNhY2hlRmFjdG9yeScsXG4gICAgICAnQ2FjYWNoZVNlcmlhbGl6ZXInLFxuICAgICAgZmFjdG9yeSA9PiBpbmZvID0+IHtcbiAgICAgICAgaWYgKGluZm8udHlwZSA9PT0gJ2RhdGEnKSB7XG4gICAgICAgICAgcmV0dXJuIFNlcmlhbGl6ZXJDYWNhY2hlUGx1Z2luLmNyZWF0ZVNlcmlhbGl6ZXIoaW5mbyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhY3RvcnkoaW5mbyk7XG4gICAgICB9LFxuICAgICk7XG4gIH1cbn1cblxuU2VyaWFsaXplckNhY2FjaGVQbHVnaW4uY3JlYXRlU2VyaWFsaXplciA9ICh7IGNhY2hlRGlyUGF0aCwgbmFtZSB9KSA9PiB7XG4gIGlmICghQ2FjYWNoZVNlcmlhbGl6ZXIpIHtcbiAgICBDYWNhY2hlU2VyaWFsaXplciA9IHJlcXVpcmUoJy4vU2VyaWFsaXplckNhY2FjaGUnKTtcbiAgfVxuXG4gIHJldHVybiBuZXcgQ2FjYWNoZVNlcmlhbGl6ZXIoe1xuICAgIGNhY2hlRGlyUGF0aDogam9pbihjYWNoZURpclBhdGgsIG5hbWUpLFxuICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2VyaWFsaXplckNhY2FjaGVQbHVnaW47XG4iXSwic291cmNlUm9vdCI6Ii9Vc2Vycy90eWxlcmFyYnVzL2Rldi9wcm92aWRlci9zcmMifQ==
