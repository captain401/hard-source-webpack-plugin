'use strict';

const RawSource = require('webpack-sources').RawSource;

const pluginCompat = require('./util/plugin-compat');

class TransformAssetPlugin {
  apply(compiler) {
    pluginCompat.tap(compiler, '_hardSourceFreezeAsset', 'TransformAssetPlugin freeze', (frozen, asset, extra) => asset.source());

    pluginCompat.tap(compiler, '_hardSourceThawAsset', 'TransformAssetPlugin thaw', (thawed, asset, extra) => {
      if (!thawed) {
        thawed = asset;
        if (thawed.type === 'buffer') {
          thawed = new Buffer(thawed);
        }
        if (!(thawed instanceof RawSource)) {
          thawed = new RawSource(thawed);
        }
      }

      return thawed;
    });
  }
}

module.exports = TransformAssetPlugin;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi9UcmFuc2Zvcm1Bc3NldFBsdWdpbi5qcyJdLCJuYW1lcyI6WyJSYXdTb3VyY2UiLCJyZXF1aXJlIiwicGx1Z2luQ29tcGF0IiwiVHJhbnNmb3JtQXNzZXRQbHVnaW4iLCJhcHBseSIsImNvbXBpbGVyIiwidGFwIiwiZnJvemVuIiwiYXNzZXQiLCJleHRyYSIsInNvdXJjZSIsInRoYXdlZCIsInR5cGUiLCJCdWZmZXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLFlBQVlDLFFBQVEsaUJBQVIsRUFBMkJELFNBQTdDOztBQUVBLE1BQU1FLGVBQWVELCtCQUFyQjs7QUFFQSxNQUFNRSxvQkFBTixDQUEyQjtBQUN6QkMsUUFBTUMsUUFBTixFQUFnQjtBQUNkSCxpQkFBYUksR0FBYixDQUNFRCxRQURGLEVBRUUsd0JBRkYsRUFHRSw2QkFIRixFQUlFLENBQUNFLE1BQUQsRUFBU0MsS0FBVCxFQUFnQkMsS0FBaEIsS0FBMEJELE1BQU1FLE1BQU4sRUFKNUI7O0FBT0FSLGlCQUFhSSxHQUFiLENBQ0VELFFBREYsRUFFRSxzQkFGRixFQUdFLDJCQUhGLEVBSUUsQ0FBQ00sTUFBRCxFQUFTSCxLQUFULEVBQWdCQyxLQUFoQixLQUEwQjtBQUN4QixVQUFJLENBQUNFLE1BQUwsRUFBYTtBQUNYQSxpQkFBU0gsS0FBVDtBQUNBLFlBQUlHLE9BQU9DLElBQVAsS0FBZ0IsUUFBcEIsRUFBOEI7QUFDNUJELG1CQUFTLElBQUlFLE1BQUosQ0FBV0YsTUFBWCxDQUFUO0FBQ0Q7QUFDRCxZQUFJLEVBQUVBLGtCQUFrQlgsU0FBcEIsQ0FBSixFQUFvQztBQUNsQ1csbUJBQVMsSUFBSVgsU0FBSixDQUFjVyxNQUFkLENBQVQ7QUFDRDtBQUNGOztBQUVELGFBQU9BLE1BQVA7QUFDRCxLQWhCSDtBQWtCRDtBQTNCd0I7O0FBOEIzQkcsT0FBT0MsT0FBUCxHQUFpQlosb0JBQWpCIiwiZmlsZSI6ImhhcmQtc291cmNlLXdlYnBhY2stcGx1Z2luL2xpYi9UcmFuc2Zvcm1Bc3NldFBsdWdpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFJhd1NvdXJjZSA9IHJlcXVpcmUoJ3dlYnBhY2stc291cmNlcycpLlJhd1NvdXJjZTtcblxuY29uc3QgcGx1Z2luQ29tcGF0ID0gcmVxdWlyZSgnLi91dGlsL3BsdWdpbi1jb21wYXQnKTtcblxuY2xhc3MgVHJhbnNmb3JtQXNzZXRQbHVnaW4ge1xuICBhcHBseShjb21waWxlcikge1xuICAgIHBsdWdpbkNvbXBhdC50YXAoXG4gICAgICBjb21waWxlcixcbiAgICAgICdfaGFyZFNvdXJjZUZyZWV6ZUFzc2V0JyxcbiAgICAgICdUcmFuc2Zvcm1Bc3NldFBsdWdpbiBmcmVlemUnLFxuICAgICAgKGZyb3plbiwgYXNzZXQsIGV4dHJhKSA9PiBhc3NldC5zb3VyY2UoKSxcbiAgICApO1xuXG4gICAgcGx1Z2luQ29tcGF0LnRhcChcbiAgICAgIGNvbXBpbGVyLFxuICAgICAgJ19oYXJkU291cmNlVGhhd0Fzc2V0JyxcbiAgICAgICdUcmFuc2Zvcm1Bc3NldFBsdWdpbiB0aGF3JyxcbiAgICAgICh0aGF3ZWQsIGFzc2V0LCBleHRyYSkgPT4ge1xuICAgICAgICBpZiAoIXRoYXdlZCkge1xuICAgICAgICAgIHRoYXdlZCA9IGFzc2V0O1xuICAgICAgICAgIGlmICh0aGF3ZWQudHlwZSA9PT0gJ2J1ZmZlcicpIHtcbiAgICAgICAgICAgIHRoYXdlZCA9IG5ldyBCdWZmZXIodGhhd2VkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCEodGhhd2VkIGluc3RhbmNlb2YgUmF3U291cmNlKSkge1xuICAgICAgICAgICAgdGhhd2VkID0gbmV3IFJhd1NvdXJjZSh0aGF3ZWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGF3ZWQ7XG4gICAgICB9LFxuICAgICk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBUcmFuc2Zvcm1Bc3NldFBsdWdpbjtcbiJdLCJzb3VyY2VSb290IjoiL1VzZXJzL3R5bGVyYXJidXMvZGV2L3Byb3ZpZGVyL3NyYyJ9
